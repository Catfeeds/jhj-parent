function expCleanOorderFormValidation(){var a=(myApp.formToJSON("#alter-order-1-view"),!0);return $$("input[name='item_num']").each(function(b,c){var d=$$(this).val();(""==d||void 0==d)&&(myApp.alert("类别数量不能为空！"),a=!1)}),a}function ValidateNumber(a,b){return/^\d+$/.test(b)||(a.value=/^\d+/.exec(a.value)),a.value}function onAddItemNum(a){var b=a.find("input[name=item_num]"),c=b.val();c=void 0!=c&&isNum(c)?parseInt(c)+1:0,b.val(c),setTotal()}function onSubItemNum(a){var b=a.find("input[name=item_num]"),c=b.val();c=void 0!=c&&isNum(c)&&0!=c?parseInt(c)-1:0,b.val(c),setTotal()}function setTotal(){var a,b=itemPrice=Number(0),c=0;$$("input[name = item_num]").each(function(d,e){itemNum=$$(this).val(),a=$$(this).parent().find("input[name=service_addon_id]"),c=a.val(),void 0!=itemNum&&isNum(itemNum)&&void 0!=c&&(itemPrice=getServiceAddonPrice(c),b=Number(b)+Number(itemNum)*Number(itemPrice))}),$$("#order_money_input").attr("value",b),$$("#order_moneys_span").text("￥"+b)}function getOrderAmInfo(a,b){}function orderFormValidation(){var a=myApp.formToJSON("#order-alert-form");if(""==a.service_content)return myApp.alert("请输入服务要求"),!1;a.order_money;return""==a.order_money||0==a.order_money?(myApp.alert("订单金额必须大于0"),!1):!0}function hrefToOrderView(a,b){var c=localStorage.am_id;localStorage.setItem("order_no_param",b),mainView.router.loadPage("order/order-view-"+a+".html?am_id="+c+"&order_no="+b)}function baiduAutoCompleteSuccess(a,b,c){var d=JSON.parse(a.response),e=d.data;e.length>0&&$$(".list-block ul").html("");var f=$$("#autocomplete-list-part-li").html(),g="";$$.each(e,function(a,b){if(void 0!=b.location){var c=f;c=c.replace(new RegExp("{item_name}","gm"),b.name),c=c.replace(new RegExp("{item_lat}","gm"),b.location.lat),c=c.replace(new RegExp("{item_lng}","gm"),b.location.lng),c=c.replace(new RegExp("{item_city}","gm"),b.city),c=c.replace(new RegExp("{item_uid}","gm"),b.uid),g+=c}}),$$(".list-block ul").append(g)}function getBaiduAutoComplete(){var a={};a.query=$$("#name").val(),a.region="131",a.output="json",a.ak="2sshjv8D4AOoOzozoutVb6WT",$$.ajax({type:"GET",url:siteAPIPath+"map/autocomplete.json",dataType:"json",cache:!0,contentType:"application/x-www-form-urlencoded; charset=utf-8",data:a,statusCode:{200:baiduAutoCompleteSuccess,400:ajaxError,500:ajaxError},success:function(){}})}function selectAddr(a){var b=a.find("input[name=item_lat]"),c=a.find("input[name=item_lng]"),d=a.find("input[name=item_city]"),e=a.find("input[name=item_uid]"),f=a.find("div[class*=item-title]"),g=c.val(),h=b.val(),i=d.val(),j=f.html(),k=e.val();$$("#name").val(j),$$("#longitude").val(g),$$("#latitude").val(h),$$("#city").val(i),$$("#uid").val(k),$$(".list-block ul").html("")}function addrFormValidation(){var a=myApp.formToJSON("#addr-form");return""==a.name?(myApp.alert("请输入小区名称."),!1):""==a.longitude||""==a.latitude?(myApp.alert("请选择你所在的小区"),!1):""==a.addr?(myApp.alert("请输入详细门牌号"),!1):!0}function setAddrDefault(a){var b=localStorage.user_id,c={};c.user_id=b,c.addr_id=a,$$.ajax({type:"POST",url:siteAPIPath+"user/post_set_addr_default.json",data:{user_id:b,addr_id:a},success:function(){$$("input[class=swipeout]").each(function(b,c){var d=$$(this).find("input[name=addr_id]"),e=$$(this).find("input[class=am-badge]");a==d.val()?e.text("默认"):e.text("")}),myApp.swipeoutClose($$(this)),myApp.addNotification({message:"操作成功",button:{text:"关闭"},hold:2e3})}})}function getOrderInfo(a){$$.ajax({type:"GET",url:siteAPIPath+"user/get_user_edit_detail.json?user_id="+a,dataType:"json",cache:!0,statusCode:{200:orderInfoSuccess,400:ajaxError,500:ajaxError}})}function saveOrderSuccess(a,b,c){$$("#mine-addr-save").removeAttr("disabled"),myApp.hideIndicator();var d=JSON.parse(a.response);return"999"==d.status?void myApp.alert(d.msg):void("0"==d.status&&(myApp.alert("信息修改成功"),mainView.router.loadPage("user/user-list.html")))}function orderFormValidation(){var a=myApp.formToJSON("#order-alert-form");return""==a.mobile?(myApp.alert("请输入手机号"),!1):""==a.remarks?(myApp.alert("请输入服务要求"),!1):!0}function tagClick(a,b){var c=$$("#tag_ids").val();b.is(".kehuxg-biaoqian")?(b.addClass("kehuxq-biaoqian"),b.removeClass("kehuxg-biaoqian"),c.indexOf(a+",")<0&&(c+=a+",")):(b.removeClass("kehuxq-biaoqian"),b.addClass("kehuxg-biaoqian"),c.indexOf(a+",")>=0&&(c=c.replace(a+",",""))),$$("#tag_ids").val(c)}function hrefToUserView(a){localStorage.setItem("user_id_param",a),mainView.router.loadPage("user/user-form-xiangqing.html?user_id="+a)}myApp.onPageInit("login",function(a){$$("#get_code").on("click",function(a){function b(){$$("#get_code").attr("disabled",!0),$$("#get_code").css("background","#999"),$$("#get_code").text(e+"秒后重新获取"),0==e&&($$("#get_code").removeAttr("disabled"),$$("#get_code").css("background","#f37b1d"),$$("#get_code").text("获取验证码"),clearInterval(f)),e--}var c=$$("#am_mobile").val();if(void 0==c||""==c)return myApp.alert("请填写手机号。"),!1;var d=c.trim();if(11!=d.length)return myApp.alert("请填写正确的手机号码"),!1;var e=60,f=setInterval(b,1e3),g={};g.mobile=d,g.sms_type=0,$$.ajax({url:siteAPIPath+"user/get_sms_token.json",contentType:"application/x-www-form-urlencoded; charset=utf-8",type:"GET",dataType:"json",cache:!0,data:g,statusCode:{201:h,400:ajaxError,500:ajaxError}});var h=function(a,b,c){myApp.hideIndicator(),myApp.alert("验证码已发送到您的手机，请注意查收。")};return!1}),$$("#login_btn").on("click",function(a){var b=$$("#am_mobile").val(),c=$$("#verify_code").val();if(""==b||""==c)return myApp.alert("请填写手机号或验证码。"),!1;if(11!=b.length)return myApp.alert("请填写正确的手机号码"),!1;var d=function(a,b,c){myApp.hideIndicator();var d=JSON.parse(a.response);return"999"==d.status?void myApp.alert(d.msg):("0"==d.status&&(localStorage.am_mobile=d.data.mobile,localStorage.am_id=d.data.staff_id),void mainView.router.loadPage("order/order-list.html"))},e={};return e.mobile=b,e.sms_token=c,e.login_from=1,e.user_type=2,$$.ajax({type:"POST",url:siteAPIPath+"am/login.json",dataType:"json",cache:!0,data:e,statusCode:{200:d,201:d,400:ajaxError,500:ajaxError}}),!1})}),myApp.onPageBeforeInit("am-mine-page",function(a){var b=localStorage.am_id;$$("#sec-logout").on("click",function(){localStorage.removeItem("am_id"),localStorage.removeItem("am_mobile"),localStorage.removeItem("service_type_addons_list"),localStorage.removeItem("service_type_list"),mainView.router.loadPage("index.html")}),$$("#getStaffDetial").on("click",function(){mainView.router.loadPage("mine/staff-list.html?amId="+b)})}),myApp.template7Data["page:am-mine-page"]=function(){var a,b={},c=localStorage.am_id;return b.amId=c,$$.ajax({type:"GET",url:siteAPIPath+"user/get_am_by_amId.json",dataType:"json",cache:!0,data:b,async:!1,success:function(b){a=b.data;var c=/[\u4E00-\u9FA5]/g,d=moment(a.birth),e=moment(d).fromNow();a.real_age=e.replace(c,""),a.astro_name=getAstroName(a.astro)},error:ajaxErrorClean}),a};var ajaxErrorClean=function(a,b,c){myApp.hideIndicator(),myApp.alert("网络繁忙,请稍后再试."),localStorage.removeItem("am_id"),localStorage.removeItem("am_mobile"),localStorage.removeItem("service_type_addons_list"),localStorage.removeItem("service_type_list"),mainView.router.loadPage("login.html")};myApp.onPageInit("staff-list-page",function(a){var b=localStorage.am_id,c={},a=1,d=!1;c.amId=b,c.page=a;var e=function(b,c,e){myApp.hideIndicator();for(var f=JSON.parse(b.response),g=f.data,h=$$("#staffList").html(),i="",j=0;j<g.length;j++){var k=g[j],l=h;l=l.replace(new RegExp("{name}","gm"),k.name),l=l.replace(new RegExp("{mobile}","gm"),k.mobile),l=l.replace(new RegExp("{tel}","gm"),k.mobile),i+=l}return $$(".staff-list ul").append(i),a+=1,d=!1,g.length<3?(myApp.detachInfiniteScroll($$(".infinite-scroll")),void $$(".infinite-scroll-preloader").remove()):void 0};c.amId=b,c.page=a,$$.ajax({type:"GET",url:siteAPIPath+"user/get_staff_by_amId.json",data:c,statusCode:{200:e,400:ajaxError,500:ajaxError}}),$$(".infinite-scroll").on("infinite",function(){d||(d=!0,c.amId=b,c.page=a,$$.ajax({type:"GET",url:siteAPIPath+"user/get_staff_by_amId.json",data:c,timeout:1e4,statusCode:{200:e,400:ajaxError,500:ajaxError}}))})}),myApp.onPageBeforeInit("alter-order-1-page",function(a){var b=(a.query.order_no,a.query.am_id,JSON.parse(localStorage.getItem("service_type_addons_list")),function(a,b,c){$$("#order-clean-submit").removeAttr("disabled"),myApp.hideIndicator();var d=JSON.parse(a.response);return"999"==d.status?void myApp.alert(d.msg):("100"==d.status&&(myApp.alert(d.msg),mainView.router.loadPage("order/order-list.html")),void("0"==d.status&&(myApp.alert("订单调整完成"),mainView.router.loadPage("order/order-list.html"))))}),c=Number(0);$$("#order-clean-submit").on("click",function(a){if($$("#order-clean-submit").attr("disabled",!0),0==expCleanOorderFormValidation())return $$("#order-clean-submit").removeAttr("disabled"),!1;var d="";$$("input[name = item_num]").each(function(a,b){c=$$(this).val();var e=$$(this).parent().find("input[name=service_addon_id]"),f=e.val();void 0!=c&&void 0!=f&&(d+="{",d+="serviceAddonId:"+f+",itemNum:"+c+",",d=d.substring(0,d.length-1)+"},")});var e=d.lastIndexOf(",");d="["+d.substring(0,e)+"]";var f=myApp.formToJSON("#alter-order-1-view");f.service_addons_datas=d,$$.ajax({type:"POST",url:siteAPIPath+"order/post_am_clean.json",dataType:"json",cache:!1,data:f,statusCode:{200:b,400:ajaxError,500:ajaxError}})})}),myApp.template7Data["page:alter-order-1-page"]=function(){var a,b=getParameterByName("am_id"),c=getParameterByName("order_no");return $$.ajax({type:"GET",url:siteAPIPath+"order/get_am_clean_detail.json?am_id="+b+"&order_no="+c,dataType:"json",cache:!0,async:!1,success:function(b){a=b.data}}),a},myApp.onPageInit("alter-order-page",function(a){var b=a.query.order_no,c=a.query.am_id,d=function(a,b,c){var d=JSON.parse(a.response);if("999"==d.status)return void myApp.alert(d.msg);var e=d.data,f={order_no:e.order_no,service_content:e.service_content,order_money:e.order_money};myApp.formFromJSON("#order-alert-form",f),$$("#order_type_name_for_am").html(e.order_type_name),$$("#order_status_name_for_am").html(e.order_status_name)};$$.ajax({type:"GET",url:siteAPIPath+"order/get_am_order_detail.json?am_id="+c+"&order_no="+b,dataType:"json",cache:!0,statusCode:{200:d,400:ajaxError,500:ajaxError}});var e=function(a,b,c){$$("#mine-addr-save").removeAttr("disabled"),myApp.hideIndicator();var d=JSON.parse(a.response),e=d.appResultData;return"999"==e.status?void myApp.alert(e.msg):void("0"==e.status&&(myApp.alert("订单调整完成"),mainView.router.loadPage("order/order-list.html")))};$$("#order-adjust-submit").on("click",function(){if($$("#mine-addr-save").attr("disabled",!0),0==orderFormValidation())return!1;var a=myApp.formToJSON("#order-alert-form");$$.ajax({type:"POST",url:siteAPIPath+"order/post_user_am.json",dataType:"json",cache:!1,data:a,statusCode:{200:e,400:ajaxError,500:ajaxError}})})}),myApp.onPageBeforeInit("order-list-page",function(a){var b=localStorage.am_id,c={},a=1,d=!1;c.am_id=b,c.page=a;var e=function(b,c,e){myApp.hideIndicator();for(var f=JSON.parse(b.response),g=f.data,h=$$("#order-am-list-part").html(),i="",j=0;j<g.length;j++){var k=g[j],l=h,m='<img alt="" src="img/icons/order_type_img_'+k.order_type+'.png"></p>';l=l.replace(new RegExp("{img_tag}","gm"),m),l=l.replace(new RegExp("{order_type}","gm"),k.order_type),l=l.replace(new RegExp("{am_id}","gm"),k.am_id),l=l.replace(new RegExp("{order_no}","gm"),k.order_no),l=l.replace(new RegExp("{order_type_name}","gm"),k.order_type_name),l=l.replace(new RegExp("{order_status_name}","gm"),k.order_status_name),l=l.replace(new RegExp("{mobile}","gm"),k.mobile),i+=l}return $$(".card-am-list ul").append(i),a+=1,d=!1,g.length<10?void $$("#order-am-list-more").css("display","none"):void 0};c.am_id=b,c.page=a,$$.ajax({type:"GET",url:siteAPIPath+"order/get_am_order_list.json",dataType:"json",cache:!0,data:c,async:!1,statusCode:{200:e,400:ajaxError,500:ajaxError}}),$$("#order-am-list-more").on("click",function(){d||(d=!0,c.am_id=b,c.page=a,$$.ajax({type:"GET",url:siteAPIPath+"order/get_am_order_list.json",dataType:"json",cache:!0,data:c,timeout:1e4,statusCode:{200:e,400:ajaxError,500:ajaxError}}))})}),myApp.template7Data["page:am-order-hour-view-0-page"]=function(){var a,b={},c=localStorage.am_id,d=localStorage.order_no_param;return b.order_no=d,b.am_id=c,$$.ajax({type:"POST",url:siteAPIPath+"order/am_Order_Hour_Detail.json",dataType:"json",data:b,cache:!0,async:!1,success:function(b){a=b.data;var c=moment.unix(a.service_date),d=c.format("YYYY-MM-DD HH:mm");a.service_date=d,""==a.staff_name&&(a.staff_name="暂未分配服务人员")}}),a},myApp.onPageInit("am-order-hour-view-0-page",function(a){var b=$$("#orderStatus").val();3==b?($$("#couponLi").hide(),$$("#realMoneyLi").hide()):($$("#couponLi").show(),$$("#realMoneyLi").show())}),myApp.onPageInit("order-view-page1",function(a){var b=a.query.am_id;if(void 0!=b&&""!=b&&0!=b){var c=a.query.order_no,b=a.query.am_id;$$(".ddxq-tiiaozheng").on("click",function(){mainView.router.loadPage("order/alter-order-view-1.html?am_id="+b+"&order_no="+c)})}}),myApp.template7Data["page:order-view-page1"]=function(){var a,b=localStorage.am_id,c=localStorage.order_no_param;return $$.ajax({type:"GET",url:siteAPIPath+"order/get_am_clean_detail.json?am_id="+b+"&order_no="+c,dataType:"json",cache:!0,async:!1,success:function(b){a=b.data}}),a},myApp.onPageInit("order-view-page2",function(a){var b=a.query.am_id;if(void 0!=b&&""!=b&&0!=b){var c=a.query.order_no,b=a.query.am_id;$$(".ddxq-tiiaozheng").on("click",function(){mainView.router.loadPage("order/alter-order.html?am_id="+b+"&order_no="+c)})}}),myApp.template7Data["page:order-view-page2"]=function(){var a,b=localStorage.am_id,c=localStorage.order_no_param;return $$.ajax({type:"GET",url:siteAPIPath+"order/get_am_order_detail.json?am_id="+b+"&order_no="+c,dataType:"json",cache:!0,async:!1,success:function(b){a=b.data}}),a},myApp.onPageBeforeInit("mine-add-addrs",function(a){var b=localStorage.user_id;if(addrId=a.query.addr_id,resultUrl=a.query.resultUrl,void 0!=b&&""!=b&&0!=b){(void 0==addrId||""==addrId)&&(addrId=0),(void 0==resultUrl||""==resultUrl)&&(resultUrl="user/mine-addr-list.html"),$$("#user_id").val(b),$$("#addr_id").val(addrId);var c=function(a,c,d){$$("#mine-addr-save").removeAttr("disabled"),myApp.hideIndicator();var e=JSON.parse(a.response);return"999"==e.status?void myApp.alert(e.msg):void mainView.router.loadPage(resultUrl+"?user_id="+b)};$$("#mine-addr-save").on("click",function(){if($$("#mine-addr-save").attr("disabled",!0),0==addrFormValidation())return!1;var a=myApp.formToJSON("#addr-form");$$.ajax({type:"POST",url:siteAPIPath+"user/post_user_addrs.json",dataType:"json",cache:!1,data:a,statusCode:{200:c,400:ajaxError,500:ajaxError}})})}}),myApp.onPageBeforeInit("mine-addr-list",function(a){var b=localStorage.user_id,c=function(a,b,c){myApp.hideIndicator();var d=JSON.parse(a.response);if("999"==d.status)return void myApp.alert(d.msg);var e=d.data,f=$$("#addr-list-part-li").html(),g="";$$.each(e,function(a,b){var c=f;c=c.replace(new RegExp("{addr_name}","gm"),b.name+b.addr),c=c.replace(new RegExp("{addr_id}","gm"),b.id);var d="";1==b.is_default&&(d="默认"),c=c.replace(new RegExp("{is_default_name}","gm"),d),g+=c}),""==g&&(g='<li style="color: #aaa">您还没有服务地址，现在就添加一个吧！</li>'),$$(".list-block ul").append(g)};$$.ajax({type:"GET",url:siteAPIPath+"user/get_user_addrs.json?user_id="+b,dataType:"json",cache:!1,statusCode:{200:c,400:ajaxError,500:ajaxError}}),$$(".mine-add-addr-link").on("click",function(){mainView.router.loadPage("user/mine-add-addr.html?addr_id=0")})}),myApp.onPageBeforeInit("user-form-bianji-page",function(a){var b=a.query.user_id;getOrderInfo(b),$$("#user-kehuzl-submit").on("click",function(){if($$("#mine-addr-save").attr("disabled",!0),0==orderFormValidation())return!1;var a=myApp.formToJSON("#user-form-bianji");$$.ajax({type:"POST",url:siteAPIPath+"user/post_user_edit.json?user_id="+b,dataType:"json",cache:!1,data:a,statusCode:{200:saveOrderSuccess,400:ajaxError,500:ajaxError}})})});var orderInfoSuccess=function(a,b,c){var d=JSON.parse(a.response),e=d.data;if("999"==d.status)return void myApp.alert(d.msg);var f=e.list,g=e.tag_list,h="";if(null!=g){for(var i=0;i<g.length;i++)h+=g[i]+",";$$("#tag_ids").val(h)}var j=!1,k="";if(null!=f)for(var l=0;l<f.length;l++){if(j=!1,null!=g)for(var i=0;i<g.length;i++)if(f[l].tag_id==g[i]){j=!0;break}k+=j?l%2==0?"<a href='#' id='tag_id_'"+e.list[l].tag_id+" onclick='tagClick("+e.list[l].tag_id+", $$(this))' class='button button-cancel button-round kehuxq-biaoqian'  style='margin-left: 2%;'>"+e.list[l].tag_name+"</a>":"<a href='#' id='tag_id_'"+e.list[l].tag_id+" onclick='tagClick("+e.list[l].tag_id+", $$(this))' class='button button-cancel button-round kehuxq-biaoqian'>"+e.list[l].tag_name+"</a>":l%2==0?"<a href='#' id='tag_id_'"+e.list[l].tag_id+" onclick='tagClick("+e.list[l].tag_id+", $$(this))' class='button button-cancel button-round kehuxg-biaoqian'  style='margin-left: 2%;'>"+e.list[l].tag_name+"</a>":"<a href='#' id='tag_id_'"+e.list[l].tag_id+" onclick='tagClick("+e.list[l].tag_id+", $$(this))' class='button button-cancel button-round kehuxg-biaoqian'>"+e.list[l].tag_name+"</a>"}$$("#tagNames").append(k),$$("#name").text(e.name),$$("#mobile").text(e.mobile),$$("#userAddr").text(e.addr_name),$$("#remarks").text(e.remarks),$$("#addrId").text(e.addr_id)};myApp.onPageInit("user-xiangqing-page",function(a){var b=a.query.user_id;$$("#kehuzl-bianji").on("click",function(){mainView.router.loadPage("user/user-form-bianji.html?user_id="+b)})}),myApp.template7Data["page:user-xiangqing-page"]=function(){var a,b=localStorage.user_id_param;return $$.ajax({type:"GET",url:siteAPIPath+"user/get_user_list_detail.json?user_id="+b,dataType:"json",cache:!0,async:!1,success:function(b){a=b.data}}),a},myApp.onPageBeforeInit("user-list-page",function(a){var b=localStorage.am_id,c=(localStorage.user_id,localStorage.order_status,{}),a=1,d=!1;c.am_id=b,c.page=a;var e=function(b,c,e){myApp.hideIndicator();for(var f=JSON.parse(b.response),g=f.data,h=$$("#user-list-part").html(),i="",j=0;j<g.length;j++){var k=g[j],l=h;l=l.replace(new RegExp("{mobile}","gm"),k.mobile),l=l.replace(new RegExp("{service_addr}","gm"),k.service_addr),l=l.replace(new RegExp("{am_id}","gm"),k.am_id),l=l.replace(new RegExp("{service_times}","gm"),k.service_times),l=l.replace(new RegExp("{user_id}","gm"),k.user_id),l=l.replace(new RegExp("{order_status_name}","gm"),k.order_status_name),i+=l}return $$(".card-user-list ul").append(i),a+=1,d=!1,g.length<10?void $$("#am-user-list-more").css("display","none"):void 0};$$.ajax({type:"GET",url:siteAPIPath+"user/get_user_list.json",dataType:"json",cache:!0,data:c,async:!1,statusCode:{200:e,400:ajaxError,500:ajaxError}}),$$("#am-user-list-more").on("click",function(){d||(d=!0,c.am_id=b,c.page=a,$$.ajax({type:"GET",url:siteAPIPath+"user/get_user_list.json",dataType:"json",cache:!0,data:c,timeout:1e4,statusCode:{200:e,400:ajaxError,500:ajaxError}}))})});