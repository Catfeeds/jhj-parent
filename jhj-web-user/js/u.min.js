function getUserInfo(){var a=localStorage.user_id;return void 0!=a&&""!=a&&0!=a&&void $$.ajax({type:"GET",url:siteAPIPath+"user/get_userinfo.json?user_id="+a,dataType:"json",cache:!1,async:!1,success:function(a){result=a.data,localStorage.setItem("is_vip",result.is_vip);var b=result.default_user_addr;void 0!=b&&null!=b&&1==b.is_default&&(localStorage.setItem("default_addr_id",b.id),localStorage.setItem("default_addr_name",b.name+" "+b.addr))}})}function orderLink(a,b){localStorage.setItem("firstServiceType",b),a=a+"?firstServiceType="+b,mainView.router.loadPage(a)}function appoinSerivceType(a,b){$$("#serviceTypeList").find("li").each(function(a,b){$$(this).removeClass("special-color2")}),a.addClass("special-color2");var c=a.html();$$("#spanServiceType").html(c),$$("#serviceTypeId").val(b)}function doAppointOrder(){var a=$$("#serviceTypeId").val(),b="";b=28==a||29==a?"order/order-hour-choose.html?service_type_id="+a:"order/order-deep-choose.html?service_type_id="+a,mainView.router.loadPage(b)}function onItemNumKeyUp(a){var b=a.find("input[name=itemNum]"),c=b.val();c=c.replace(/\D/g,""),b.val(c),setDeepTotal()}function onDeepAddItemNum(a){var b=a.find("input[name=itemNum]"),c=b.val();c=void 0!=c&&isNum(c)?parseInt(c)+1:0,b.val(c);setDeepTotal()}function onDeepSubItemNum(a){var b=a.find("input[name=itemNum]"),c=b.val();c=void 0!=c&&isNum(c)&&0!=c?parseInt(c)-1:0,b.val(c);setDeepTotal()}function checkDefaultNum(){var a=0,b=0;$$("input[name = itemNum]").each(function(c,d){itemNum=$$(this).val(),void 0!=itemNum&&""!=itemNum||(itemNum=0),a=Number(a)+Number(itemNum);var e=($$(this).parent().find("input[name=serviceAddonName]").val(),$$(this).parent().find("input[name=defaultNum]").val());0==b?b=e:b>e&&(b=e)});var c="";return Number(b)>0&&Number(a)<Number(b)&&(c="最低数量为"+b),c}function setItemNum(a,b){var c=b,d=sessionStorage.getItem("service_addons_json");if(void 0==d||""==d)return c;var e=JSON.parse(d);return $$.each(e,function(b,d){var e=d.serviceAddonId,f=d.itemNum;if(e==a)return c=f,!1}),c}function setDeepTotal(){var a,b=itemPrice=Number(0),c=0,d=0,e=[],f=[],g=localStorage.is_vip;void 0!=g&&""!=g||(g=0),$$("input[name = itemNum]").each(function(h,i){itemNum=$$(this).val(),void 0!=itemNum&&""!=itemNum||(itemNum=0),a=$$(this).parent().find("input[name=serviceAddonId]"),d=a.val();var j=$$(this).parent().find("input[name=serviceAddonName]").val(),k=$$(this).parent().find("input[name=defaultNum]").val();if(0==itemNum||void 0==d||0==d)return!1;var l=$$(this).parent().find("input[name=serviceAddonServiceHour]").val(),m=$$(this).parent().find("input[name=serviceAddonPrice]").val(),n=$$(this).parent().find("input[name=serviceAddonDisPrice]").val(),o=/[1-9][0-9]*/g;0==g&&(itemPrice=m.match(o)),1==g&&(itemPrice=n.match(o)),b=Number(b)+Number(itemNum)*Number(itemPrice);var p=l*itemNum;""!=k&&0!=k&&(p=l/k*itemNum),c+=p;var q=$$(this).parent().find("input[name=serviceAddonItemUnit]").val(),r={};r.serviceAddonName=j,r.serviceAddonId=d,r.itemNum=itemNum,r.itemUnit=q,f.push(r);var s={};s.serviceAddonId=d,s.itemNum=itemNum,e.push(s)}),c=c.toFixed(0),sessionStorage.setItem("order_money",b),sessionStorage.setItem("order_pay",b),sessionStorage.setItem("total_service_hour",c),sessionStorage.setItem("service_addons",JSON.stringify(f)),sessionStorage.setItem("service_addons_json",JSON.stringify(e));var h=checkDefaultNum();return void 0!=h&&""!=h?h:h}function formValidation(){var a=myApp.formToJSON("#orderHour-Form"),b=a.serviceDate,c=moment().unix();if(""==b||0==b||b<=c)return myApp.alert("现在时间："+moment().format("YYYY-MM-DD HH:MM ")+"\r\n请选择合适的服务时间"),!1;var d=$$("#orderDeepAddrId").val;return 0!=d&&""!=d&&void 0!=d||(alert("请选择服务地址"),!1)}function onStaffNumsAdd(){var a=$$("#staffNums").val();a=a.replace(/\D|^0/g,""),a++,a<0&&(staffsNums=0),$$("#staffNums").val(a),setOrderHourTotal()}function onStaffNumsSub(){var a=$$("#staffNums").val();a=a.replace(/\D|^0/g,""),a--,a<0&&(staffsNums=0),$$("#staffNums").val(a),setOrderHourTotal()}function onServiceHoursAdd(){var a=$$("#serviceHours").val();a=a.replace(/\D|^0/g,""),a++,a<0&&(a=0),$$("#serviceHours").val(a),setOrderHourTotal()}function onServiceHoursSub(){var a=$$("#serviceHours").val();a=a.replace(/\D|^0/g,""),a--,a<0&&(a=0),$$("#serviceHours").val(a),setOrderHourTotal()}function setOrderHourTotal(){var a=$$("#staffNums").val();a=a.replace(/\D|^0/g,""),$$("#staffNums").val(a);var b=$$("#serviceHours").val();if(b=b.replace(/\D|^0/g,""),$$("#serviceHours").val(b),void 0==a||""==a||a<=0)return alert("预约服务人员数量最少为1个人."),$$("#staffNums").val(1),!1;if(a>5)return alert("预约服务人员数量最多可以指定5人."),$$("#staffNums").val(5),!1;var c=$$("#minServiceHour").val(),d=$$("#maxServiceHour").val();if(void 0==b||""==b||b<c)return alert("预约服务时间最少为"+c+"小时."),$$("#serviceHours").val(c),!1;if(b>d)return alert("预约服务时间最多为"+d+"小时."),$$("#serviceHours").val(d),!1;var e=$$("#price").val(),f=$$("#mprice").val(),g=$$("#pprice").val(),h=$$("#mpprice").val(),i=localStorage.is_vip;void 0!=i&&""!=i||(i=0);var j=g,k=e;return 1==i&&(j=h,k=f),(a>1||b>c)&&(j=k*b*a),$$("#orderHourPayStr").html(j+"元"),sessionStorage.setItem("order_money",j),sessionStorage.setItem("order_pay",j),sessionStorage.setItem("total_staff_nums",a),sessionStorage.setItem("total_service_hour",b),!0}function initOrderHour(){var a=sessionStorage.getItem("total_staff_nums");if(void 0==a||""==a||a<=0)return!1;$$("#staffNums").val(a);var b=$$("#minServiceHour").val(),c=($$("#maxServiceHour").val(),sessionStorage.getItem("total_service_hour"));if(void 0==c||""==c||c<b)return!1;$$("#serviceHours").val(c);var d=sessionStorage.getItem("order_pay");return void 0!=d&&""!=d&&void $$("#orderHourPayStr").html(d+"元")}function formValidation(){var a=myApp.formToJSON("#orderHour-Form"),b=a.serviceDate,c=moment().unix();if(""==b||0==b||b<=c)return myApp.alert("现在时间："+moment().format("YYYY-MM-DD HH:MM ")+"\r\n请选择合适的服务时间"),!1;var d=$$("#orderHourAddrId").val;return 0!=d&&""!=d&&void 0!=d||(alert("请选择服务地址"),!1)}function orderView(a,b){var c="";0==a&&(c="order/order-view-0.html"),1==a&&(c="order/order-view-1.html"),sessionStorage.setItem("order_type",a),sessionStorage.setItem("order_no",b),mainView.router.loadPage(c)}function doOrderPay(a){var b=a.find("input[name=orderStatus]").val();if(1!=b)return!1;var c=a.find("input[name=serviceTypeId]").val(),d=a.find("input[name=orderId]").val(),e=a.find("input[name=orderNo]").val(),f=a.find("input[name=orderPay]").val(),g=a.find("input[name=userCouponId]").val(),h=a.find("input[name=userCouponValue]").val();sessionStorage.setItem("service_type_id",c),sessionStorage.setItem("order_id",d),sessionStorage.setItem("order_no",e),sessionStorage.setItem("order_pay",f),sessionStorage.setItem("user_coupon_id",g),sessionStorage.setItem("user_coupon_value",h),sessionStorage.setItem("pay_order_type",0),mainView.router.loadPage("order/order-pay.html")}function doOrderPayExt(a){var b=a.find("input[name=orderStatus]").val();if(b>=3&&b<7){var c=a.find("input[name=serviceTypeId]").val(),d=a.find("input[name=orderId]").val(),e=a.find("input[name=orderNo]").val(),f=a.find("input[name=orderPay]").val(),g=a.find("input[name=staffNames]").val();sessionStorage.setItem("service_type_id",c),sessionStorage.setItem("order_id",d),sessionStorage.setItem("order_no",e),sessionStorage.setItem("order_pay",f),sessionStorage.setItem("staff_names",g),mainView.router.loadPage("order/order-pay-ext.html")}}function linkOrderRate(a){var b=a.find("input[name=orderStatus]").val();if(b<=2)return!1;var c=a.find("input[name=orderId]").val();sessionStorage.setItem("order_id",c);var d=a.find("input[name=orderNo]").val();sessionStorage.setItem("order_no",d);var e=a.find("input[name=orderType]").val();sessionStorage.setItem("order_type",e);var f=a.find("input[name=staffNames]").val();sessionStorage.setItem("staff_names",f);var g="order/order-rate.html";8==b&&(g="order/order-user-rate.html"),mainView.router.loadPage(g)}function changePayType(a,b){$$("#orderPayType").val(b);var c=["img-restpay","img-wxpay","img-alipay"];$$.each(c,function(b,c){c==a?$$("#"+c).attr("src","img/dingdan-pay/dingdan-pay1.png"):$$("#"+c).attr("src","img/dingdan-pay/dingdan-pay2.png")})}function reStaffOrder(a,b){return void 0!=a&&""!=a&&0!=a&&(sessionStorage.setItem("staff_id",a),sessionStorage.setItem("staff_names",b),void mainView.router.loadPage("order/order-appoint.html"))}function reOrder(a,b){return void 0!=a&&""!=a&&0!=a&&(sessionStorage.setItem("staff_id",a),sessionStorage.setItem("staff_names",b),void mainView.router.loadPage("order/order-appoint.html"))}function doRateArrival(a){0==a&&($$("#rateArrival_0").removeClass("waiter1-2").addClass("waiter1-1"),$$("#rateArrival_1").removeClass("waiter1-1").addClass("waiter1-2")),1==a&&($$("#rateArrival_0").removeClass("waiter1-1").addClass("waiter1-2"),$$("#rateArrival_1").removeClass("waiter1-2").addClass("waiter1-1")),$$("#rateArrival").val(a)}function doRateAttitude(a){for(var b=1;b<=5;b++)a>=b?$$("#rateAttitude_"+b).attr("src","img/yudingayi/xx.png"):$$("#rateAttitude_"+b).attr("src","img/yudingayi/xx1.png");$$("#rateAttitude").val(a)}function doRateSkill(a){for(var b=1;b<=5;b++)a>=b?$$("#rateSkill_"+b).attr("src","img/yudingayi/xx.png"):$$("#rateSkill_"+b).attr("src","img/yudingayi/xx1.png");$$("#rateSkill").val(a)}function setImagePreviews(a){var b=a.files;if(b.length>0)for(var c="",d=0,e=0,f=b.length;e<f;e++){var g=new FileReader,h=b[e];if(!/image\/\w+/.test(h.type))return alert("文件必须为图片！"),!1;g.readAsDataURL(h),g.onload=function(a){c+="<div class='waiter4-1'><img src='"+a.target.result+"' alt=''/></div><div class='waiter4-2' id='delImg' onclick='delImg(this)'>×</div>",d++,d<=4&&$$("#img").html(c)}}}function delImg(a){var b=$$(a).prev();b.remove(),$$(a).remove()}function removeSessionData(){sessionStorage.removeItem("service_type_id"),sessionStorage.removeItem("service_date"),sessionStorage.removeItem("service_date_str"),sessionStorage.removeItem("addr_id"),sessionStorage.removeItem("addr_name"),sessionStorage.removeItem("order_type"),sessionStorage.removeItem("order_no"),sessionStorage.removeItem("order_id"),sessionStorage.removeItem("order_pay"),sessionStorage.removeItem("order_money"),sessionStorage.removeItem("service_addons"),sessionStorage.removeItem("service_addons_json"),sessionStorage.removeItem("total_service_hour"),sessionStorage.removeItem("total_staff_nums"),sessionStorage.removeItem("pay_order_type"),sessionStorage.removeItem("user_coupon_id"),sessionStorage.removeItem("user_coupon_value"),sessionStorage.removeItem("user_coupon_name"),sessionStorage.removeItem("staff_id"),sessionStorage.removeItem("staff_names"),sessionStorage.removeItem("serDate"),sessionStorage.removeItem("card_id")}function getItemAddrId(){var a="";return void 0!=localStorage.default_addr_id&&null!=localStorage.default_addr_id&&"undefined"!=localStorage.default_addr_id&&(a=localStorage.default_addr_id),void 0!=sessionStorage.getItem("addr_id")&&null!=sessionStorage.getItem("addr_id")&&"undefined"!=sessionStorage.getItem("addr_id")&&(a=sessionStorage.getItem("addr_id")),a}function getItemAddrName(){var a="";return void 0!=localStorage.default_addr_name&&null!=localStorage.default_addr_name&&"undefined"!=localStorage.default_addr_name&&(a=localStorage.default_addr_name),void 0!=sessionStorage.getItem("addr_name")&&null!=sessionStorage.getItem("addr_name")&&"undefined"!=sessionStorage.getItem("addr_name")&&(a=sessionStorage.getItem("addr_name")),a}function orderRecomment(a){var b=[];if(void 0!=a&&""!=a&&null!=a){var c=[{name:"家务包月",url:"order/fiveservice/order-cus-hostwork-month.html",serviceTypeId:"61"},{name:"油烟机清洗",url:"order/order-deep-intro.html?service_type_id=36",serviceTypeId:"36"},{name:"擦玻璃",url:"order/order-deep-intro.html?service_type_id=54",serviceTypeId:"54"},{name:"洗衣机清洗",url:"order/order-deep-intro.html?service_type_id=60",serviceTypeId:"60"}],d=[{name:"油烟机清洗",url:"order/order-deep-intro.html?service_type_id=36",serviceTypeId:"36"},{name:"金牌保洁",url:"order/order-hour-intro.html",serviceTypeId:"28"},{name:"洗衣机清洗",url:"order/order-deep-intro.html?service_type_id=60",serviceTypeId:"60"},{name:"空调清洗",url:"order/order-deep-intro.html?service_type_id=51",serviceTypeId:"51"}],e=[{name:"油烟机清洗",url:"order/order-deep-intro.html?service_type_id=36",serviceTypeId:"36"},{name:"金牌保洁",url:"order/order-hour-intro.html",serviceTypeId:"28"},{name:"洗衣机清洗",url:"order/order-deep-intro.html?service_type_id=60",serviceTypeId:"60"},{name:"地板保养打蜡",url:"order/order-deep-intro.html?service_type_id=52",serviceTypeId:"52"}],f=[{name:"擦玻璃",url:"order/order-deep-intro.html?service_type_id=54",serviceTypeId:"54"},{name:"金牌保洁",url:"order/order-hour-intro.html",serviceTypeId:"28"},{name:"床铺除螨杀菌",url:"",serviceTypeId:"34"},{name:"地板保养打蜡",url:"order/order-deep-intro.html?service_type_id=52",serviceTypeId:"52"}],g=[{name:"擦玻璃",url:"order/order-deep-intro.html?service_type_id=54",serviceTypeId:"54"},{name:"地板保养打蜡",url:"order/order-deep-intro.html?service_type_id=52",serviceTypeId:"52"},{name:"洗衣机清洗",url:"order/order-deep-intro.html?service_type_id=60",serviceTypeId:"60"},{name:"冰箱清洗",url:"order/order-deep-intro.html?service_type_id=50",serviceTypeId:"50"}],h=[{name:"擦玻璃",url:"order/order-deep-intro.html?service_type_id=54",serviceTypeId:"54"},{name:"金牌保洁",url:"order/order-hour-intro.html",serviceTypeId:"28"},{name:"床铺除螨杀菌",url:"",serviceTypeId:"34"},{name:"房屋大扫除",url:"order/order-deep-intro.html?service_type_id=53",serviceTypeId:"53"}],i=[{name:"擦玻璃",url:"order/order-deep-intro.html?service_type_id=54",serviceTypeId:"54"},{name:"金牌保洁",url:"order/order-hour-intro.html",serviceTypeId:"28"},{name:"床铺除螨杀菌",url:"order/order-deep-intro.html?service_type_id=34",serviceTypeId:"34"},{name:"房屋大扫除",url:"order/order-deep-intro.html?service_type_id=53",serviceTypeId:"53"}],j=[{name:"油烟机清洗",url:"order/order-deep-intro.html?service_type_id=36",serviceTypeId:"36"},{name:"金牌保洁",url:"order/order-hour-intro.html",serviceTypeId:"28"},{name:"洗衣机清洗",url:"order/order-deep-intro.html?service_type_id=60",serviceTypeId:"60"},{name:"冰箱清洗",url:"order/order-deep-intro.html?service_type_id=50",serviceTypeId:"50"}],k=[{name:"油烟机清洗",url:"order/order-deep-intro.html?service_type_id=36",serviceTypeId:"36"},{name:"金牌保洁",url:"order/order-hour-intro.html",serviceTypeId:"28"},{name:"空调清洗",url:"order/order-deep-intro.html?service_type_id=51",serviceTypeId:"51"},{name:"冰箱清洗",url:"order/order-deep-intro.html?service_type_id=50",serviceTypeId:"50"}],l=[{name:"家务包月",url:"order/fiveservice/order-cus-hostwork-month.html",serviceTypeId:"61"},{name:"地板保养打蜡",url:"order/order-deep-intro.html?service_type_id=52",serviceTypeId:"52"},{name:"洗衣机清洗",url:"order/order-deep-intro.html?service_type_id=60",serviceTypeId:"60"},{name:"金牌保洁",url:"order/order-hour-intro.html",serviceTypeId:"28"}],m=[{name:"冰箱清洗",url:"order/order-deep-intro.html?service_type_id=50",serviceTypeId:"50"},{name:"洗衣机清洗",url:"order/order-deep-intro.html?service_type_id=60",serviceTypeId:"60"},{name:"金牌保洁",url:"order/order-hour-intro.html",serviceTypeId:"28"},{name:"家务包月",url:"order/fiveservice/order-cus-hostwork-month.html",serviceTypeId:"61"}],n=[{name:"油烟机清洗",url:"order/order-deep-intro.html?service_type_id=36",serviceTypeId:"36"},{name:"洗衣机清洗",url:"order/order-deep-intro.html?service_type_id=60",serviceTypeId:"60"},{name:"空调清洗",url:"order/order-deep-intro.html?service_type_id=51",serviceTypeId:"51"},{name:"厨卫深度清洁杀菌",url:"order/order-deep-intro.html?service_type_id=35",serviceTypeId:"35"}],o=[{name:"月子房",url:"order/order-yuezifang-intro.html",serviceTypeId:"62"},{name:"家务包月",url:"order/fiveservice/order-cus-hostwork-month.html",serviceTypeId:"61"},{name:"油烟机清洗",url:"order/order-deep-intro.html?service_type_id=36",serviceTypeId:"36"},{name:"洁宝宝",url:"order/order-cleanbaby-intro.html",serviceTypeId:"64"}],p=[{name:"洁宝宝",url:"",serviceTypeId:"64"},{name:"家务包月",url:"order/fiveservice/order-cus-hostwork-month.html",serviceTypeId:"61"},{name:"油烟机清洗",url:"order/order-deep-intro.html?service_type_id=36",serviceTypeId:"36"},{name:"洗衣机清洗",url:"order/order-deep-intro.html?service_type_id=60",serviceTypeId:"60"}],q=[{name:"洁宝宝",url:"order-cleanbaby-intro.html",serviceTypeId:"64"},{name:"家务包月",url:"order/fiveservice/order-cus-hostwork-month.html",serviceTypeId:"61"},{name:"油烟机清洗",url:"order/order-deep-intro.html?service_type_id=36",serviceTypeId:"36"},{name:"厨卫深度清洁杀菌",url:"order/order-deep-intro.html?service_type_id=35",serviceTypeId:"35"}],r=[{name:"月子房",url:"order/order-yuezifang-intro.html",serviceTypeId:"62"},{name:"家务包月",url:"order/fiveservice/order-cus-hostwork-month.html",serviceTypeId:"61"},{name:"油烟机清洗",url:"order/order-deep-intro.html?service_type_id=36",serviceTypeId:"36"},{name:"洗衣机清洗",url:"order/order-deep-intro.html?service_type_id=60",serviceTypeId:"60"}];b=[{serviceTypeId:"28",list:c},{serviceTypeId:"50",list:d},{serviceTypeId:"54",list:e},{serviceTypeId:"35",list:f},{serviceTypeId:"34",list:g},{serviceTypeId:"52",list:h},{serviceTypeId:"53",list:i},{serviceTypeId:"51",list:j},{serviceTypeId:"60",list:k},{serviceTypeId:"56",list:l},{serviceTypeId:"36",list:m},{serviceTypeId:"61",list:n},{serviceTypeId:"63",list:o},{serviceTypeId:"62",list:p},{serviceTypeId:"65",list:q},{serviceTypeId:"29",list:c},{serviceTypeId:"64",list:r},{serviceTypeId:"67",list:c}];for(var s=0;s<b.length;s++){var t=b[s],u=t.serviceTypeId;if(u==a)return t.list}}}function baiduAutoCompleteSuccess(a,b,c){var d=JSON.parse(a.response),e=d.data;if($$("#addr-auto-list ul").html(""),e.length<=0)return!1;var f=$$("#autocomplete-list-part-li").html(),g="";$$.each(e,function(a,b){if(void 0!=b.location){var c=f;c=c.replace(new RegExp("{item_name}","gm"),b.name),c=c.replace(new RegExp("{item_lat}","gm"),b.location.lat),c=c.replace(new RegExp("{item_lng}","gm"),b.location.lng),c=c.replace(new RegExp("{item_city}","gm"),b.city),c=c.replace(new RegExp("{item_uid}","gm"),b.uid),g+=c}}),$$("#addr-auto-list ul").html(g)}function getBaiduAutoComplete(){var a={};return a.query=$$("#name").val(),a.region="北京市",a.output="json",a.ak="2sshjv8D4AOoOzozoutVb6WT",!($$("#name").val().length<=0)&&void $$.ajax({type:"GET",url:siteAPIPath+"map/autocomplete.json",dataType:"json",cache:!0,contentType:"application/x-www-form-urlencoded; charset=utf-8",data:a,statusCode:{200:baiduAutoCompleteSuccess,400:ajaxError,500:ajaxError},success:function(){}})}function selectAddr(a){var b=a.find("li"),c=b.find("input[name=item_lat]"),d=b.find("input[name=item_lng]"),e=b.find("input[name=item_city]"),f=b.find("input[name=item_uid]"),g=b.find("div[class*=item-title]"),h=d.val(),i=c.val(),j=e.val(),k=g.html(),l=f.val();$$("#name").val(k),$$("#longitude").val(h),$$("#latitude").val(i),$$("#city").val(j),$$("#uid").val(l),$$("#addr-auto-list ul").html("")}function addrFormValidation(){var a=myApp.formToJSON("#addr-form");return""==a.name?(myApp.alert("请输入小区名或大厦名，并在下拉列表中选择。"),!1):""==a.longitude||""==a.latitude?(myApp.alert("请输入小区名或大厦名，并在下拉列表中选择。"),!1):""!=a.addr||(myApp.alert("请输入详细门牌号"),!1)}function clickToSetDefault(a,b){var c=$$(a).find("#mine-add-addr-link").text();if(c.indexOf("默认")>0)return localStorage.setItem("default_addr_name",c.replace("[默认]","").trim()),localStorage.setItem("default_addr_id",b),goBackToOrder(localStorage.default_addr_id,localStorage.default_addr_name),!1;var d=localStorage.user_id,e={};e.user_id=d,e.addr_id=b,myApp.confirm("设置为默认地址?",function(){$$.ajax({type:"POST",url:siteAPIPath+"user/post_set_addr_default.json",data:{user_id:d,addr_id:b},async:!1,success:function(){$$(".addr-dizhi").each(function(a,c){var d=$$(this).find("#addr_id").val(),e=$$(this).find("#mine-add-addr-link"),f=e.html();b==d?f.indexOf("默认")<0&&(localStorage.default_addr_id=b,localStorage.default_addr_name=f.trim(),e.html("[默认] "+f)):e.html(f.replace("[默认]","")),myApp.swipeoutClose($$(this))}),goBackToOrder(localStorage.default_addr_id,localStorage.default_addr_name)}})},function(){goBackToOrder(b,c)})}function goBackToOrder(a,b){for(var c="",d=1;d<5;d++){var e=mainView.history[mainView.history.length-d];if(void 0!=e&&(e.indexOf("order-hour-choose")>=0||e.indexOf("order-deep-choose")>=0)){c=e;break}}""!=c&&(sessionStorage.setItem("addr_id",a),sessionStorage.setItem("addr_name",b),mainView.router.loadPage(c))}function delAddr(a){var b=$$(a).next().val();return null!=b&&""!=b&&void 0!=b&&void $$.ajax({type:"get",url:siteAPIPath+"user/delete_addr.json",data:{addr_id:b},success:function(){}})}function saveUserFeedBack(a){var b={};b.user_id=a,b.content=$$("#service_content").val(),$$.ajax({type:"POST",url:siteAPIPath+"user/post_feed_back.json",dataType:"json",cache:!0,data:b,statusCode:{200:saveUserFeedBackSuccess,400:ajaxError,500:ajaxError}})}function saveUserSuccess(a,b,c){$$("#user_mine_submit").removeAttr("disabled"),myApp.hideIndicator();var d=JSON.parse(a.response);return"999"==d.status?void myApp.alert(d.msg):void("0"==d.status&&mainView.router.loadPage("user/mine.html"))}function getMineInfos(a){var b={};b.user_id=a,$$.ajax({type:"GET",url:siteAPIPath+"user/get_userinfo.json",dataType:"json",cache:!0,data:b,statusCode:{200:onMineInfoSuccess,400:ajaxError,500:ajaxError}})}function generateSurveyResultOption(){var a={},b=$$("#optionDisplay input[name='optionNo']:checked");if(0==b.length)return myApp.alert("请您任意选择一项,叮当到家将为您提供更为贴心的订制服务"),!1;var c="";b.each(function(a,b){c+=$$(this).parent().find("input[id='realOptionNo']").val()+","}),a.option_str=c.substring(0,c.length-1),a.q_id=$$("#questionId").val();var d={questionId:a.q_id,optionStr:a.option_str},e=[],f=$("#isFirst").val();if(e.push(d),0==f&&localStorage.setItem("surveyResult",JSON.stringify(e)),1==f||2==f){JSON.parse(localStorage.surveyResult),e.concat(JSON.parse(localStorage.surveyResult)),JSON.stringify(e.concat(JSON.parse(localStorage.surveyResult)));localStorage.setItem("surveyResult",JSON.stringify(e.concat(JSON.parse(localStorage.surveyResult))))}return a}function replaceChildContentBoxNumber(a){var b=a.match(/\d/g).join("");return a=a.replace(/\d+/g,"<input type='tel' id='finalChildTimes' maxlength='3' class='input-child-content-box-style' value='' placeholder='"+b+"' >")}function ValidateNumber(a,b){return/^\d+$/.test(b)||(a.value=/^\d+/.exec(a.value)),a.value}function onAddItemNum(a){var b=a.find("input[name=item_num]"),c=b.val();c=void 0!=c&&isNum(c)?parseInt(c)+1:0,b.val(""),b.val(c)}function onSubItemNum(a){var b=a.find("input[name=item_num]"),c=b.val();c=void 0!=c&&isNum(c)&&0!=c?parseInt(c)-1:0,b.val(""),b.val(c)}function storeNowData(){var a=$$("#resultDiv").find("a[id='contentName'][class='button button-fill service-button1']"),b=[],c=[],d=[];$$(a).each(function(a,e){var f=$$(this).parent().parent().find("#contentDiv"),g=$$(this).parent().parent().find("#timesDiv"),h=g.find("#contentTimes").text().match(/\d/g).join(""),i=f.find("#contentChildType").val(),j=f.find("#contentId").val();if(0==i&&b.push({baseContentId:j,baseContentTimes:Number(h)}),1==i){var k=g.find("input[id='childRadioContentId']").val(),l=[];l.push({childRadioContentId:k,childRadioContentTimes:Number(h)}),c.push({baseContentId:j,childRadioArray:l})}2==i&&d.push({baseContentId:j})}),localStorage.setItem("storeBaseArray",JSON.stringify(b)),localStorage.setItem("storeRadioArray",JSON.stringify(c)),localStorage.setItem("storeChildBoxArray",JSON.stringify(d))}function generateTimeWordForTimes(a){var b="";return 0==a&&(b="次/月"),1==a&&(b="次/年"),2!=a&&3!=a||(b="次"),b}function changeColor(a){var b=$$(a).attr("class");if(b.indexOf("service-button1")>0){$$(a).attr("class","button button-fill service-button2");var c=$$(a).parent().parent().find("a[id='changeThisTimes']");c.attr("class","button button-fill service-button2"),c.attr("disabled",!0)}if(b.indexOf("service-button2")>0){$$(a).attr("class","button button-fill service-button1");var c=$$(a).parent().parent().find("a[id='changeThisTimes']");c.attr("class","button button-fill service-button"),c.removeAttr("disabled")}}function changeThisTimes(a){if($$(a).attr("class").indexOf("button2")>0)return!1;var b=$$(a).parent().find("#contentChildType").val(),c=$$(a).parent().find("#contentId").val();if(2==b){storeNowData(),localStorage.setItem("changeContentId",c);var d="survey/survey-result-child.html";mainView.router.loadPage(d)}if(0==b)return myApp.prompt("","次数修改",function(b){if(!isPositiveNum(b)||Number(b)>700||0==b.indexOf(0))return myApp.alert("请输入小于700的整数数字"),!1;var c=$$(a).parent().parent().parent().find("span[id='contentTimes']");c.text(c.text().replace(/\d+/g,b))}),!1;var c=$$(a).parent().find("#contentId").val(),e={};e.content_id=c,$$.ajax({type:"get",url:siteAPIPath+"survey/get_child_content_list.json",data:e,success:function(c,d,e){var f=JSON.parse(c),g=f.data.length,h="";if(1==b)for(var i=0;i<g;i++){var j=f.data[i];h+=j.id==$$(a).parent().parent().parent().find("#timesDiv").find("#childRadioContentId").val()?"<li><input type='hidden' id='childRadioId' value="+j.default_time_child+"><input type='radio' checked name='childRadio' value="+j.id+">"+j.option_str+"</li>":"<li><input type='hidden' id='childRadioId' value="+j.default_time_child+"><input type='radio'  name='childRadio' value="+j.id+">"+j.option_str+"</li>"}$$("#childReplace").html(""),$$("#childReplace").append(h),2!=b&&myApp.confirm($$("#childReplace").html(),"<b>服务次数调整</b>",function(){if(1==b){var c=$$("input[type='radio'][name='childRadio']:checked").val();$$(a).parent().parent().parent().find("#timesDiv").find("#childRadioContentId").val(c);var d=$$("input[type='radio'][name='childRadio']:checked").parent().find("input[id='childRadioId']").val(),e=$$(a).parent().parent().parent().find("span[id='contentTimes']");e.text(e.text().replace(/\d+/g,d))}})},error:function(){myApp.alert("网络错误")}})}function isPositiveNum(a){var b=/^[0-9]*[1-9][0-9]*$/;return b.test(a)}function replaceChildContentBoxNumber(a){var b=a.match(/\d/g).join("");return a=a.replace(/\d+/g,"<input type='tel' id='finalChildTimes' maxlength='3' class='input-child-content-box-style' value='' placeholder='"+b+"' >")}function surveyUserValidation(){var a=$$("#userName").val().replace(/\s/g,"");if(a.length<1||void 0==a)return myApp.alert("请输入您的姓名"),!1;var b=$$("#age").val();if(isNaN(b)||0===b.indexOf(0)||""==b.replace(/\s/g,""))return myApp.alert("请输入合法的年龄"),!1;var c=$$("#mobile").val();return isPhone(c)?void 0:(myApp.alert("请输入合法的手机号"),!1)}function isPhone(a){var b=RegExp(/^(0|86|17951)?(13[0-9]|14[0-9]|15[0-9]|16[0-9]|17[0-9]|18[0-9]|19[0-9])[0-9]{8}$/).test(a);return!!b}myApp.onPageInit("login",function(a){$$("#get_code").on("click",function(a){function b(){$$("#get_code").css("background","#999"),$$("#get_code").text(e+"秒"),0==e&&($$("#get_code").removeAttr("disabled"),$$("#get_code").css("background","#f37b1d"),$$("#get_code").text("获取验证码"),clearInterval(f)),e--}var c=$$("#user_mobile").val();if(void 0==c||""==c)return myApp.alert("请填写手机号。"),!1;var d=c.trim();if(11!=d.length)return myApp.alert("请填写正确的手机号码"),!1;$$("#get_code").css("background","#999");var e=60,f=setInterval(b,1e3);$$(this).attr("disabled",!0);var g=function(a,b,c){myApp.hideIndicator(),myApp.alert("验证码已发送到您的手机，请注意查收。")},h={};return h.mobile=d,h.sms_type=0,$$.ajax({url:siteAPIPath+"user/get_sms_token.json",contentType:"application/x-www-form-urlencoded; charset=utf-8",type:"GET",dataType:"json",cache:!0,data:h,statusCode:{201:g,400:ajaxError,500:ajaxError}}),!1}),$$("#get_code_yuyin").on("click",function(a){function b(){$$("#get_code").attr("disabled",!0),$$("#get_code").css("background","#999"),$$("#get_code").text(e+"秒"),0==e&&($$("#get_code").removeAttr("disabled"),$$("#get_code").css("background","#f37b1d"),$$("#get_code").text("获取验证码"),clearInterval(f)),e--}var c=$$("#user_mobile").val();if(void 0==c||""==c)return myApp.alert("请填写手机号。"),!1;var d=c.trim();if(11!=d.length)return myApp.alert("请填写正确的手机号码"),!1;var e=60,f=setInterval(b,1e3),g={};g.mobile=d,g.sms_type=0,$$.ajax({url:siteAPIPath+"user/get_yu_yin_token.json",contentType:"application/x-www-form-urlencoded; charset=utf-8",type:"GET",dataType:"json",cache:!0,data:g,statusCode:{201:h,400:ajaxError,500:ajaxError}});var h=function(a,b,c){myApp.hideIndicator(),myApp.alert("验证码已发送到您的手机，请注意查收。")};return!1}),$$("#login_btn").on("click",function(a){var b=$$("#user_mobile").val(),c=$$("#verify_code").val();if(""==b||""==c)return myApp.alert("请填写手机号或验证码。"),!1;if(11!=b.length)return myApp.alert("请填写正确的手机号码"),!1;var d=function(a,b,c){myApp.hideIndicator(),$$("#login_btn").removeAttr("disabled");var d=JSON.parse(a.response);if("999"==d.status)return void myApp.alert(d.msg);if("0"==d.status){localStorage.setItem("user_mobile",d.data.mobile),localStorage.setItem("user_id",d.data.id),localStorage.setItem("is_vip",d.data.is_vip);var e=d.default_user_addr;void 0!=e&&null!=e&&1==e.is_default&&(localStorage.setItem("default_addr_id",e.id),localStorage.setItem("default_addr_name",e.name+" "+e.addr))}var f=d.data.has_user_addr;if(1==f){var g=mainView.history[mainView.history.length-2];mainView.router.loadPage(g)}else mainView.router.loadPage("user/mine-add-addr.html")};$$(this).attr("disabled",!0);var e={};return e.mobile=b,e.sms_token=c,e.login_from=1,e.user_type=0,$$.ajax({type:"POST",url:siteAPIPath+"user/login.json",dataType:"json",cache:!0,data:e,statusCode:{200:d,201:d,400:ajaxError,500:ajaxError}}),!1}),$$(".yanzheng1").click(function(){$$(".login-tishi1").css("display","block")})}),myApp.onPageBeforeInit("order-appoint",function(a){var b=sessionStorage.getItem("staff_id"),c=sessionStorage.getItem("staff_names");$$("#staffId").val(b),$$("#staffName").val(c),$$("#spanStaffName").html(c)}),myApp.template7Data["page:order-appoint"]=function(){var a="",b=sessionStorage.getItem("staff_id");return $$.ajax({type:"GET",url:siteAPIPath+"staff/get_skills.json?staff_id="+b,dataType:"json",cache:!0,async:!1,success:function(b){a=b}}),a},myApp.onPageBeforeInit("order-baby-intro",function(a){removeSessionData()}),myApp.onPageBeforeInit("order-cal-page",function(a){function b(a,b,c){var d={};d.user_id=a,d.year=b,d.month=c+1;var e="order/user_total_by_month.json",f=function(a,d,e){for(var f=JSON.parse(a.response),g=(f.data,f.data),h=[],j=0;j<g.length;j++){var l=new Date(g[j].service_date);h.push(new Date(l.getFullYear(),l.getMonth(),l.getDate()))}h.length>0&&(k.params.events=h,k.setYearMonth(b,c,1),i=c)};$$.ajax({type:"GET",url:siteAPIPath+e,dataType:"json",cache:!0,data:d,statusCode:{200:f,400:ajaxError,500:ajaxError}})}function c(a,b,c){var d={};d.user_id=a,d.year=b,d.month=c+1;var e="order/user_total_order.json",f=function(a,b,c){for(var d=JSON.parse(a.response),e=d.data,f=0;f<e.length;f++)void 0!=e[f].total&&$("#total").html(e[f].total),void 0!=e[f].total_uf&&$("#total_uf").html(e[f].total_uf)};$$.ajax({type:"GET",url:siteAPIPath+e,dataType:"json",cache:!0,data:d,statusCode:{200:f,400:ajaxError,500:ajaxError}})}function d(a,b,c){e=c;var d={},f="order/user_order_list.json";d.user_id=a,d.page=b,d.day=c;var g=function(a,c,d){for(var e=JSON.parse(a.response),f=e.data,g=$$("#order-hour-list").html(),h="",i=0;i<f.length;i++){var j=f[i],k=g;k=k.replace(new RegExp("{order_type}","gm"),j.order_type),k=k.replace(new RegExp("{order_no}","gm"),j.order_no),k=k.replace(new RegExp("{order_hour_type_name}","gm"),j.order_hour_type_name),k=k.replace(new RegExp("{order_hour_status_name}","gm"),j.order_hour_status_name),k=2==j.order_type?k.replace(new RegExp("{service_date}","gm"),"预约时间: "+moment.unix(j.add_time).format("YYYY-MM-DD HH:mm")):k.replace(new RegExp("{service_date}","gm"),"服务时间: "+moment.unix(j.service_date).format("YYYY-MM-DD HH:mm")),k=k.replace(new RegExp("{address}","gm"),j.address),h+=k}1==b?$$("#card-hour-now-list ul").html(h):$$("#card-hour-now-list ul").append(h),l=!1,b+=1,$$("#page").val(b),f.length<10&&$$("#order-list-more").css("display","none")};$$.ajax({type:"GET",url:siteAPIPath+f,dataType:"json",cache:!0,data:d,statusCode:{200:g,400:ajaxError,500:ajaxError}})}var e,f=localStorage.getItem("user_id"),g=["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],h=new Date,i=((new Date).setDate(h.getDate()+7),h.getMonth()),j={container:"#calendar-inline-container",header:!1,footer:!1,value:[new Date],dateFormat:"yyyy-mm-dd",
weekHeader:!0,firstDay:1,dayNamesShort:["周日","周一","周二","周三","周四","周五","周六"],toolbarTemplate:'<div class="toolbar calendar-custom-toolbar"><div class="toolbar-inner"><div class="left"><a href="#" class="link icon-only"><i class="icon icon-back"></i></a></div><div class="center"></div><div class="right"><a href="#" class="link icon-only"><i class="icon icon-forward"></i></a></div></div></div>',onOpen:function(a){$$(".calendar-custom-toolbar .center").text(g[a.currentMonth]+", "+a.currentYear),$$(".calendar-custom-toolbar .left .link").on("click",function(){k.prevMonth()}),$$(".calendar-custom-toolbar .right .link").on("click",function(){k.nextMonth()})},onMonthYearChangeStart:function(a){$$(".calendar-custom-toolbar .center").text(g[a.currentMonth]+", "+a.currentYear),a.currentMonth!=i&&b(f,a.currentYear,a.currentMonth),c(f,a.currentYear,a.currentMonth)},onDayClick:function(a,b,c,e,g){var h=parseInt(e)+1;d(f,1,c+"-"+h+"-"+g)}},k=myApp.calendar(j),f=f;b(f,h.getFullYear(),h.getMonth()),c(f,h.getFullYear(),h.getMonth());var l=!1,a=$$("#page").val();$$(document).once("pageBeforeAnimation",function(){var b=new Date,c=b.getFullYear()+"-"+(b.getMonth()+1)+"-"+b.getDate();d(f,a,c)}),$$("#order-list-more").on("click",function(){var b=++a;d(f,b,e)})}),myApp.onPageBeforeInit("order-deep-choose",function(a){var b=localStorage.user_id;getUserInfo();var c=a.query.service_type_id;sessionStorage.setItem("service_type_id",c),sessionStorage.setItem("order_type",1),$$.ajax({type:"GET",url:siteAPIPath+"dict/get_service_type_addons.json?service_type_id="+c,dataType:"json",async:!1,success:function(a){var b=a.data;$$.each(b,function(a,b){var c="",d=b.name;if("金牌保洁"==d)return!1;c="<ul class='order-rili'>",c+="<li>"+d+"</li>",c+='<li><span onclick="onDeepSubItemNum($$(this).parent())">-</span>';var e=setItemNum(b.service_addon_id,b.default_num);c+='<input name="itemNum" value="'+e+'" onkeyup="onItemNumKeyUp($$(this).parent())"  onafterpaste="onItemNumKeyUp($$(this).parent())"  maxLength="3" autocomplete="off">',c+='<input type="hidden" name="serviceAddonName" value="'+d+'" autocomplete="off">',c+='<input type="hidden" name="defaultNum" value="'+b.default_num+'" autocomplete="off">',c+='<input type="hidden" name="serviceAddonServiceHour" value="'+b.service_hour+'" autocomplete="off">',c+='<input type="hidden" name="serviceAddonItemUnit" value="'+b.item_unit+'" autocomplete="off">',c+='<input type="hidden" name="serviceAddonPrice" value="'+b.price+'" autocomplete="off">',c+='<input type="hidden" name="serviceAddonDisPrice" value="'+b.dis_price+'" autocomplete="off">',c+='<input type="hidden" name="serviceAddonId" value="'+b.service_addon_id+'" autocomplete="off">',c+='<span onclick="onDeepAddItemNum($$(this).parent())">+</span></li>',c+="</ul>",$$("#order-deep-content").append(c)})}});var d=getItemAddrId(),e=getItemAddrName();void 0!=d&&""!=d&&$$("#addrId").val(d),4953==b&&(myApp.alert("addrId = "+d),myApp.alert("addrID val = "+$$("#addrId").val())),void 0==e&&""==e||$$("#orderChooseAddrName").html(e),$$("#chooseServiceTime").on("click",function(){var a=setDeepTotal();if(void 0!=a&&""!=a)return myApp.alert(a),!1;var b=sessionStorage.getItem("order_money");if(void 0==b||""==b||0==b)return myApp.alert("请选择服务数量."),!1;var c=$$("#addrId").val();if(void 0==c||""==c||0==c)return myApp.alert("请选择地址."),!1;var d="order/order-lib-cal.html?next_url=order/order-deep-confirm.html",e=sessionStorage.getItem("staff_id");void 0!=e&&""!=e&&null!=e&&(d+="?staff_id="+e),mainView.router.loadPage(d)})}),myApp.onPageInit("order-deep-confirm",function(a){sessionStorage.setItem("pay_order_type",0);var b=sessionStorage.getItem("order_type");$$("#orderType").val(b);var c=sessionStorage.getItem("service_type_id");$$("#serviceType").val(c),$$.ajax({type:"GET",url:siteAPIPath+"dict/get_service_type.json?service_type_id="+c,dataType:"json",cache:!0,async:!1,success:function(a){var b=a.data;if(void 0==b||""==b)return!1;$$("#serviceTypeName").html(b.name),$$("#serviceContent").val(b.name);var c=b.is_multi;1==c&&$$("#isMultiStr").html("两人以上服务人员")}});var d=sessionStorage.getItem("order_money");$$("#priceStr").html(d),$$("#orderMoneyStr").html(d+"元"),$$("#orderMoney").val(d),$$("#serviceHourStr").html(sessionStorage.getItem("total_service_hour")+"小时");var e=localStorage.user_id;$$("#userId").val(e);var f=getItemAddrId(),g=getItemAddrName();if(void 0!=f&&""!=f&&0!=f&&$$("#orderDeepAddrId").val(f),void 0==g&&""==g||$$("#orderHourAddrName").html(g),4953==e&&(myApp.alert("addrId = "+f),myApp.alert("oDAddrId val = "+$$("#orderDeepAddrId").val()),myApp.alert("session addr_id = "+sessionStorage.getItem("addr_id"))),null!=sessionStorage.getItem("service_date")&&$$("#serviceDate").val(sessionStorage.getItem("service_date")),null!=sessionStorage.getItem("service_date_str")&&$$("#serviceDateStr").html(sessionStorage.getItem("service_date_str")),null!=sessionStorage.getItem("user_coupon_id")){if($$("#userCouponId").val(sessionStorage.getItem("user_coupon_id")),null!=sessionStorage.getItem("user_coupon_name")&&$$("#userCouponName").html(sessionStorage.getItem("user_coupon_name")),null!=sessionStorage.getItem("user_coupon_value")){var h=sessionStorage.getItem("user_coupon_value");void 0!=h&&""!=h&&null!=h||(h=0),$$("#userCouponValue").val(h);var i=d-h;i<0&&(i=0),sessionStorage.setItem("order_pay",i)}}else{var j={};j.user_id=$$("#userId").val(),j.service_type=$$("#serviceType").val(),j.service_date=$$("#serviceDate").val(),j.order_money=$$("#orderMoney").val(),$$.ajax({type:"GET",url:siteAPIPath+"user/get_validate_coupons.json",dataType:"json",cache:!0,data:j,async:!0,success:function(a){var b=a.data,c=0;c=void 0==b||""==b?0:b.length;var d=0,e=0,f="";c>0&&($$.each(b,function(a,b){b.value>d&&(d=b.value,e=b.id,f="￥"+d)}),sessionStorage.setItem("user_coupon_id",e),sessionStorage.setItem("user_coupon_name",f),sessionStorage.setItem("user_coupon_value",d));var g=c+"张可用";if(0!=e&&0!=d){var h=$$("#orderMoney").val()-d;h<0&&(h=0),sessionStorage.setItem("order_pay",h),g=f}$$("#userCouponName").html(g),$$("#orderPayStr").html(sessionStorage.getItem("order_pay")+"元")}})}$$("#orderPayStr").html(sessionStorage.getItem("order_pay")+"元"),$$("#orderHourSubmit").click(function(){if(0==formValidation())return!1;var a={};a.user_id=$$("#userId").val(),a.mobile=localStorage.user_mobile,a.service_type=$$("#serviceType").val(),a.service_date=$$("#serviceDate").val(),a.serviceHour=sessionStorage.getItem("total_service_hour"),a.addr_id=$$("#orderDeepAddrId").val(),a.service_addons_datas=sessionStorage.getItem("service_addons_json"),a.remarks=$$("#remarks").val(),a.order_from=$$("#orderFrom").val();var b=sessionStorage.getItem("staff_id");void 0!=b&&""!=b&&null!=b||(b=0),a.staff_id=b,$$.ajax({type:"post",url:siteAPIPath+"order/post_exp.json",data:a,success:function(a,b,c){var d=JSON.parse(a);if("999"==d.status)return void myApp.alert(d.msg);sessionStorage.setItem("order_no",d.data.order_no),sessionStorage.setItem("order_id",d.data.id),sessionStorage.removeItem("service_date"),sessionStorage.removeItem("service_dateStr"),sessionStorage.removeItem("addr_id"),sessionStorage.removeItem("addr_name"),myApp.formDeleteData("orderHour-Form");var e="order/order-pay.html";mainView.router.loadPage(e)},error:function(a,b){myApp.alert("网络异常,请稍后再试.")}})})}),myApp.onPageBeforeInit("order-deep-intro",function(a){function b(a){$$.get("order/deepIntro/order-deep-intro-"+a+".html",function(a){$$("#serviceTypeIntroDiv").html(a)})}removeSessionData();var c=a.query.service_type_id;switch(sessionStorage.setItem("service_type_id",c),parseInt(c)){case 34:b(c),$$("#order-deep-img").attr("src","img/chuangpuchuman/banner-34.png");break;case 35:b(c),$$("#order-deep-img").attr("src","img/chuweixiaodu/banner-35.png");break;case 36:b(c),$$("#order-deep-img").attr("src","img/youyanji/banner-36.png");break;case 50:b(c),$$("#order-deep-img").attr("src","img/bingxiang/banner-50.png");break;case 51:b(c),$$("#order-deep-img").attr("src","img/kongtiaoqingxi/banner-51.png");break;case 52:b(c),$$("#order-deep-img").attr("src","img/dibandala/banner-52.png");break;case 53:b(c),$$("#order-deep-img").attr("src","img/fangwu/banner-53.png");break;case 54:b(c),$$("#order-deep-img").attr("src","img/caboli/banner-54.png");break;case 56:b(c),$$("#order-deep-img").attr("src","img/kaihuang/banner-56.png");break;case 60:b(c),$$("#order-deep-img").attr("src","img/xiyiji/banner-60.png")}var d="";void 0!=c&&""!=c&&null!=c&&($$.ajax({type:"GET",url:siteAPIPath+"dict/get_service_type_addons.json?service_type_id="+c,dataType:"json",async:!1,success:function(a){for(var b=a.data,c=0;c<b.length;c++){var e=b[c].name;"金牌保洁"!=e&&(d+="<ul class='shendu-bx-xd11'><li>"+b[c].name+"</li><li>"+b[c].price+"/"+b[c].item_unit+"</li><li>"+b[c].dis_price+"/"+b[c].item_unit+"</li></ul>")}}}),$$("#serviceAddons").append(d),$$("#order-deep-click").on("click",function(){var a="order/order-deep-choose.html?service_type_id="+c;mainView.router.loadPage(a)}))}),myApp.onPageInit("order-hour-choose",function(a){var b=localStorage.user_id;getUserInfo();var c=a.query.service_type_id;sessionStorage.setItem("service_type_id",c);var c=sessionStorage.getItem("service_type_id");$$("#serviceType").val(c),$$.ajax({type:"GET",url:siteAPIPath+"dict/get_service_type.json?service_type_id="+c,dataType:"json",cache:!0,async:!1,success:function(a){var b=a.data;if(void 0==b||""==b)return!1;$$("#price").val(b.price),$$("#mprice").val(b.mprice),$$("#pprice").val(b.pprice),$$("#mpprice").val(b.mpprice);var c=localStorage.is_vip;void 0!=c&&""!=c||(c=0),1==c&&$$("#orderHourPayStr").html(b.mpprice+"元")}});var d=6,e=3;29==c&&(e=2),$$("#maxServiceHour").val(d),$$("#minServiceHour").val(e),$$("#serviceHours").val(e),sessionStorage.setItem("order_type",0);var f=getItemAddrId(),g=getItemAddrName();void 0!=f&&""!=f&&$$("#addrId").val(f),4953==b&&(myApp.alert("addrId = "+f),myApp.alert("addrID val = "+$$("#addrId").val())),void 0!=g&&""!=g&&$$("#orderChooseAddrName").html(g),initOrderHour(),$$("#chooseServiceTime").on("click",function(){var a=setOrderHourTotal();if(0==a)return!1;var b=$$("#addrId").val();if(void 0==b||""==b||0==b)return myApp.alert("请选择地址."),!1;var c="order/order-lib-cal.html?next_url=order/order-hour-confirm.html",d=sessionStorage.getItem("staff_id");void 0!=d&&""!=d&&null!=d&&(c+="?staff_id="+d),mainView.router.loadPage(c)})}),myApp.onPageBeforeInit("order-hour-confirm",function(a){sessionStorage.setItem("pay_order_type",0);var b=sessionStorage.getItem("order_type");$$("#orderType").val(b);var c=sessionStorage.getItem("service_type_id");$$("#serviceType").val(c),$$.ajax({type:"GET",url:siteAPIPath+"dict/get_service_type.json?service_type_id="+c,dataType:"json",cache:!0,async:!1,success:function(a){var b=a.data;return void 0!=b&&""!=b&&($$("#serviceTypeName").html(b.name),void $$("#serviceContent").val(b.name))}});var d=localStorage.user_id;$$("#userId").val(d);var e=getItemAddrId(),f=getItemAddrName();void 0!=e&&""!=e&&0!=e&&$$("#orderHourAddrId").val(e),void 0!=f&&""!=f&&$$("#orderHourAddrName").html(f),4953==d&&(myApp.alert("addrId = "+e),myApp.alert("oHAddrId val = "+$$("#orderHourAddrId").val()),myApp.alert("session addr_id = "+sessionStorage.getItem("addr_id"))),null!=sessionStorage.getItem("service_date")&&$$("#serviceDate").val(sessionStorage.getItem("service_date")),null!=sessionStorage.getItem("service_date_str")&&$$("#serviceDateStr").html(sessionStorage.getItem("service_date_str"));var g=sessionStorage.getItem("total_staff_nums"),h=sessionStorage.getItem("total_service_hour"),i=(sessionStorage.getItem("order_pay"),sessionStorage.getItem("order_money"));if($$("#staffNums").val(g),$$("#serviceHour").val(h),$$("#serviceHourStr").html(h+"小时"),$$("#orderMoney").val(i),$$("#priceStr").html(i),$$("#orderMoneyStr").html(i+"元"),$$("#isMultiStr").html(g+"位服务人员"),null!=sessionStorage.getItem("user_coupon_id")){if($$("#userCouponId").val(sessionStorage.getItem("user_coupon_id")),null!=sessionStorage.getItem("user_coupon_name")&&$$("#userCouponName").html(sessionStorage.getItem("user_coupon_name")),null!=sessionStorage.getItem("user_coupon_value")){var j=sessionStorage.getItem("user_coupon_value");void 0!=j&&""!=j&&null!=j||(j=0),$$("#userCouponValue").val(j);var k=$$("#orderMoney").val()-j;k<0&&(k=0),sessionStorage.setItem("order_pay",k)}}else{var l={};l.user_id=$$("#userId").val(),l.service_type=$$("#serviceType").val(),l.service_date=sessionStorage.getItem("service_date"),l.order_money=$$("#orderMoney").val(),$$.ajax({type:"GET",url:siteAPIPath+"user/get_validate_coupons.json",dataType:"json",cache:!0,data:l,async:!0,success:function(a){var b=a.data,c=0;c=void 0==b||""==b?0:b.length;var d=0,e=0,f="";c>0&&($$.each(b,function(a,b){b.value>d&&(d=b.value,e=b.id,f="￥"+d)}),sessionStorage.setItem("user_coupon_id",e),sessionStorage.setItem("user_coupon_name",f),sessionStorage.setItem("user_coupon_value",d));var g=c+"张可用";if(0!=e&&0!=d){var h=$$("#orderMoney").val()-d;h<0&&(h=0),sessionStorage.setItem("order_pay",h),g=f}$$("#userCouponName").html(g),$$("#orderHourPayStr").html(sessionStorage.getItem("order_pay")+"元")}})}$$("#orderHourPayStr").html(sessionStorage.getItem("order_pay")+"元"),$$("#orderHourSubmit").click(function(){if(0==formValidation())return!1;var a=$$("#orderHourAddrId").val();if(void 0==a||""==a||0==a)return alert("请选择地址."),!1;var b={};b.userId=$$("#userId").val(),b.serviceType=$$("#serviceType").val(),b.serviceContent=$$("#serviceContent").val(),b.serviceDate=$$("#serviceDate").val(),b.addrId=a,b.staffNums=$$("#staffNums").val(),b.serviceHour=$$("#serviceHour").val(),b.remarks=$$("#remarks").val(),b.orderFrom=$$("#orderFrom").val();var c=sessionStorage.getItem("staff_id");void 0!=c&&""!=c&&null!=c||(c=0),b.staff_id=c,$$.ajax({type:"post",url:siteAPIPath+"order/post_hour.json",data:b,success:function(a,b,c){var d=JSON.parse(a);if("999"==d.status)return void myApp.alert(d.msg);sessionStorage.setItem("order_no",d.data.order_no),sessionStorage.setItem("order_id",d.data.id),sessionStorage.removeItem("service_date"),sessionStorage.removeItem("service_dateStr"),sessionStorage.removeItem("addr_id"),sessionStorage.removeItem("addr_name"),myApp.formDeleteData("orderHour-Form");var e="order/order-pay.html";mainView.router.loadPage(e)},error:function(a,b){myApp.alert("网络异常,请稍后再试.")}})})}),myApp.onPageBeforeInit("order-hour-intro",function(a){removeSessionData()}),myApp.onPageInit("order-lib-cal",function(a){function b(a){var b="",c="";if(void 0!=a&&null!=a&&""!=a){for(var d=moment(a).format("YYYY-MM-DD"),e=0;e<7;e++){var j=moment(a).add(e,"days"),k=j.format("d");b+="<li>"+j.format("DD")+"</li>",d==m?(0==e&&(p[k]="今天",parseInt(k)+1>6?p[0]="明天":p[parseInt(k)+1]="明天"),c+="<li>"+p[k]+"</li>"):c+="<li>"+o[k]+"</li>"}$$("#rilikongjian2-week").html(c),$$("#rilikongjian3-day").html(b),$$(".rilikongjian p").text(moment(n).format("YYYY")),$$("#rilikongjian1-month").text(moment(n).format("MM")),$$("#rilikongjian3-day li").on("click",function(){u=$$(this),$$("#rilikongjian3-day").find("li").removeClass("beijingse"),$$("#rilikongjian3-dateTime").find("li").removeClass("hour-beijingse beijingse"),$$("#all-button2").removeClass("all-button2").addClass("all-button11"),$$(this).addClass("beijingse"),h();g();g()==m&&r>=16&&($$("#rilikongjian3-day li").removeClass("beijingse"),$$(u).addClass("beijingse"),$$("#rilikongjian3-dateTime li").addClass("hour-beijingse")),g()<m&&$$("#rilikongjian3-dateTime li").addClass("hour-beijingse"),f(),i()}),$$("#rilikongjian3-dateTime li").removeClass("hour-beijingse"),i(),f(),$$("#rilikongjian3-day").find(":first-child").addClass("beijingse"),d==m&&h(d)}}function c(a){var c=moment(m).add(a,"days");n=c,b(c)}function d(a){var c=moment(m).add(a,"days");n=c,b(c)}function e(){for(var a="",b=0;b<q.length;b++){var c=["11:30","12:00","12:30"];a+=q[b]==c[0]||q[b]==c[1]||q[b]==c[2]?"<li class='rilikongjian3-1 hour-beijingse'>"+q[b]+"</li>":"<li class='rilikongjian3-1'>"+q[b]+"</li>"}$$("#rilikongjian3-dateTime").html(a)}function f(){for(var a=$$("#rilikongjian3-dateTime").find("li"),b=7;b<=9;b++)$$(a[b]).addClass("hour-beijingse"),t=$$(a[b]).text(),t=""}function g(){var a="",b=$$(".rilikongjian p").text(),c=$$("#rilikongjian1-month").text(),d=$$(u).text();void 0!=$$(u).text()&&""!=$$(u).text()&&null!=$$(u).text()||(d=moment(m).add(s,"days").format("DD"));var e=$$(u).prevAll("li"),f=$$(u).nextAll("li"),g=!1,h=!1;if(e.length>0&&f.length>0){for(var i=0;i<e.length;i++){var j=e[i].innerHTML;g=j<d}for(var k=0;k<f.length;k++){var j=f[k].innerHTML;(j>d||j<d)&&(h=!0)}a=g&&h?b+"-"+c+"-"+d:moment(b+"-"+c+"-"+d).add(1,"M").format("YYYY-MM-DD")}if(0==e.length){var l=$$(f[0]).text(),n=$$(f[5]).text();a=l>d||l<d&&n<d?b+"-"+c+"-"+d:moment(b+"-"+c+"-"+d).add(1,"M").format("YYYY-MM-DD")}if(0==f.length){var o=$$(e[0]).text(),p=$$(e[5]).text();a=o<d&&p<d?b+"-"+c+"-"+d:moment(b+"-"+c+"-"+d).add(1,"M").format("YYYY-MM-DD")}return 0==f.length&&0==e.length&&(a=b+"-"+c+"-"+d),a}function h(a){var b;if(void 0==a||null==a||""==a)var b=g();else b=a;if(b==moment().format("YYYY-MM-DD")){var c=$$("#rilikongjian3-dateTime").find("li");if(r>=0&&r<=4)for(var d=0;d<=c.length;d++)d<2&&$$(c[d]).addClass("hour-beijingse");if(r>=4&&r<=6)for(var d=0;d<=c.length;d++)d<4&&$$(c[d]).addClass("hour-beijingse");if(7==r)for(var d=0;d<=c.length;d++)d<6&&$$(c[d]).addClass("hour-beijingse");if(r>=8&&r<=9)for(var d=0;d<=c.length;d++)d<10&&$$(c[d]).addClass("hour-beijingse");if(10==r)for(var d=0;d<=c.length;d++)d<12&&$$(c[d]).addClass("hour-beijingse");if(11==r)for(var d=0;d<=c.length;d++)d<14&&$$(c[d]).addClass("hour-beijingse");if(12==r)for(var d=0;d<=c.length;d++)d<16&&$$(c[d]).addClass("hour-beijingse");if(13==r)for(var d=0;d<=c.length;d++)d<18&&$$(c[d]).addClass("hour-beijingse");if(r>=14&&r<=15)for(var d=0;d<=c.length;d++)d<20&&$$(c[d]).addClass("hour-beijingse");if(r>=16&&r<=19)for(var e=moment().add(1,"days").format("DD"),h=$$("#rilikongjian3-day").find("li"),d=0;d<=h.length;d++){var a=$$(h[d]).text();e==a&&($$("#rilikongjian3-day li").removeClass("beijingse"),$$(h[d]).addClass("beijingse"))}if(r>=20&&r<=23){for(var d=0;d<=c.length;d++)d<2&&$$(c[d]).addClass("hour-beijingse");$$("#rilikongjian3-day li").removeClass("beijingse"),$$("#rilikongjian3-day").find("li:nth-child(2)").addClass("beijingse")}}b>moment().format("YYYY-MM-DD")&&$$("#rilikongjian3-dateTime").find("li").removeClass("hour-beijingse"),f()}function i(){var a=sessionStorage.getItem("serDate"),b=sessionStorage.getItem("total_service_hour");if(""!=a&&null!=a&&void 0!=a)for(var c=a.split(","),d=0;d<c.length;d++){var e=c[d],f=moment(e).add(b,"hours").add(2,"hours"),h=moment(e).subtract(b,"hours").subtract(2,"hours"),i=moment(f).format("YYYY-MM-DD"),j=moment(e).format("HH:mm"),k=f.format("HH:mm"),l=h.format("HH:mm");c[d].split(" ");if(i==g())for(var d=0;d<q.length;d++){var m=d;if(l>=q[0]&&q[d]>l&&q[d]<=j){var n=$$("#rilikongjian3-dateTime li");$$(n[m]).addClass("hour-beijingse")}if(l<q[0]&&q[d]<=j){var n=$$("#rilikongjian3-dateTime li");$$(n[m]).addClass("hour-beijingse")}if(q[d]>=j&&q[d]<=k){var n=$$("#rilikongjian3-dateTime li");$$(n[m]).addClass("hour-beijingse")}}}}var j=a.query.next_url,k=a.url,l=k.split("staff_id=")[1];void 0!=l&&null!=l&&""!=l||(l=0);var m=moment().format("YYYY-MM-DD"),n=m,o=["周日","周一","周二","周三","周四","周五","周六"],p=["周日","周一","周二","周三","周四","周五","周六"],q=["08:00","08:30","09:00","09:30","10:00","10:30","11:00","11:30","12:00","12:30","13:00","13:30","14:00","14:30","15:00","15:30","16:00","16:30","17:00","17:30","18:00"],r=moment().hour(),s=0,t="",u="#rilikongjian3-day li[class='beijingse']";b(m),$$("#rilikongjian1-left").click(function(){$$("#rilikongjian3-dateTime").find("li").removeClass("beijingse"),$$("#all-button2").removeClass("all-button2").addClass("all-button11");var a=$$(u).parent().find(":first-child").text();null==a&&(a=$$("#rilikongjian3-day").find("li[class='beijingse']").text());var b="";if(null==a||""==a){if(a=moment(g()).subtract(1,"days"),a.format("YYYY-MM-DD")<=m)return!1;var d=moment(g()).format("DD"),e=a.format("YYYY-MM"),f=moment(g()).format("YYYY-MM"),h=$$(a).parent().find(":first-child").text();b=h>d&&e<=f?g():h<d&&e<=f?g():moment(m).format("YYYY-MM")+"-"+a.format("DD")}else b=moment().format("YYYY-MM")+"-"+a;return!(b<=m)&&(s--,void c(s))}),$$("#rilikongjian1-right").click(function(){$$("#rilikongjian3-dateTime").find("li").removeClass("beijingse"),$$("#all-button2").removeClass("all-button2").addClass("all-button11"),s++,d(s)}),e(),$$("#rilikongjian3-dateTime li").on("click",function(){$$("#rilikongjian3-dateTime").find("li").removeClass("beijingse");var a=$$(u).text();$$(this).addClass("beijingse"),$$(this).hasClass("hour-beijingse")?(t="",$$("#all-button2").removeClass("all-button2").addClass("all-button11")):t=$$(this).text(),""!=t&&null!=a&&$$("#all-button2").removeClass("all-button11").addClass("all-button2")}),h(),0!=l&&null!=l&&""!=l&&$$.ajax({type:"GET",url:siteAPIPath+"/staff/get_dispatch_dates.json?staff_id="+l,dataType:"json",success:function(a){a.data.length>0&&sessionStorage.setItem("serDate",a.data)}}),$$("#all-button2").click(function(){var a=g()+" "+t+":00";if(""!=t){sessionStorage.setItem("service_date_str",g()+"("+o[moment(g()).format("d")]+")"+t);var b=moment(a).unix();sessionStorage.setItem("service_date",b),mainView.router.loadPage(j)}})}),myApp.onPageBeforeInit("order-list",function(a){function b(a,b){var c={},d="order/user_order_list.json";c.user_id=a,c.page=b,$$.ajax({type:"GET",url:siteAPIPath+d,dataType:"json",cache:!0,data:c,statusCode:{200:e,400:ajaxError,500:ajaxError}})}removeSessionData();var c=localStorage.user_id,d=!1,a=$$("#page").val(),e=function(b,c,e){for(var f=JSON.parse(b.response),g=f.data,h=$$("#order-list-part").html(),i="",j=0;j<g.length;j++){var k=g[j],l=h;l=l.replace(new RegExp("{orderType}","gm"),k.order_type),l=l.replace(new RegExp("{orderId}","gm"),k.id),l=l.replace(new RegExp("{orderNo}","gm"),k.order_no),l=l.replace(new RegExp("{serviceTypeId}","gm"),k.service_type),l=l.replace(new RegExp("{orderPay}","gm"),k.order_pay),l=l.replace(new RegExp("{serviceTypeName}","gm"),k.service_type_name),l=l.replace(new RegExp("{orderStatusStr}","gm"),k.order_status_name),l=l.replace(new RegExp("{serviceDateStr}","gm"),k.service_date_str),l=l.replace(new RegExp("{addrName}","gm"),k.address),l=l.replace(new RegExp("{orderPayStr}","gm"),k.order_pay+"元"),l=l.replace(new RegExp("{userCouponId}","gm"),k.coupon_id),l=l.replace(new RegExp("{userCouponValue}","gm"),k.coupon_value),l=l.replace(new RegExp("{orderStatus}","gm"),k.order_status),l=l.replace(new RegExp("{staffNames}","gm"),k.staff_names);var m=k.order_status,n="none";1==m&&(n="block"),l=l.replace(new RegExp("{doOrderPayStyle}","gm"),n);var o=k.pay_type,p="none";m>=3&&m<7&&6!=o&&(p="block"),l=l.replace(new RegExp("{priceExtendStyle}","gm"),p);var q="立即评价",r="none";m>=3&&m<=8&&(r="block"),8==m&&(q="已评价"),l=l.replace(new RegExp("{orderRateStr}","gm"),q),l=l.replace(new RegExp("{orderRateStyle}","gm"),r),i+=l}1==a?$$("#order-list-div").html(i):$$("#order-list-div").append(i),d=!1,$$("#page").val(a),g.length>=10?$$("#order-list-more").css("display","block"):$$("#order-list-more").css("display","none")};$$("#order-list-more").on("click",function(){var d=++a;b(c,d)}),b(c,a)}),myApp.onPageBeforeInit("order-pay-ext",function(a){localStorage.user_id;$$("#orderPriceExtSumbit").click(function(){var a=$$("#orderPayExt").val();return""==a||0==a||void 0==a?(myApp.alert("请输入金额."),!1):(sessionStorage.setItem("pay_order_type",3),sessionStorage.setItem("order_pay",a),void mainView.router.loadPage("order/order-pay.html"))})}),myApp.template7Data["page:order-pay-ext"]=function(){var a={},b=sessionStorage.getItem("staff_names");return a.staffNames=b,a},myApp.onPageInit("order-pay-success",function(a){var b=(a.query.order_no,a.query.order_type,a.query.service_type_id);""!=sessionStorage.getItem("service_type_id")&&(b=sessionStorage.getItem("service_type_id"));var c=orderRecomment(b);if(void 0!=c&&""!=c){var d="";$$.each(c,function(a,b){d+='<a href="'+b.url+'" class="special-color2"><span>'+b.name+"</span></a>"}),$$("#recoList").append(d)}}),myApp.onPageInit("order-pay",function(a){function b(){var a={};a.user_id=d,a.order_no=f;var b=$$("#userCouponId").val();void 0==b&&(b=0),a.user_coupon_id=b,a.order_pay_type=$$("#orderPayType").val(),$$.ajax({type:"post",url:siteAPIPath+"order/post_pay.json",data:a,statusCode:{200:n,400:ajaxError,500:ajaxError}})}function c(){var a={};a.user_id=d,a.order_no=f,a.order_pay_ext=h,a.order_pay_type=$$("#orderPayType").val(),$$.ajax({type:"post",url:siteAPIPath+"order/post_pay_ext.json",data:a,statusCode:{200:n,400:ajaxError,500:ajaxError}})}var d=localStorage.user_id,e=sessionStorage.getItem("service_type_id"),f=sessionStorage.getItem("order_no"),g=sessionStorage.getItem("order_id"),h=sessionStorage.getItem("order_pay"),i=sessionStorage.getItem("user_coupon_id"),j=sessionStorage.getItem("user_coupon_value");void 0!=j&&""!=j&&null!=j||(j=0);var k=sessionStorage.getItem("pay_order_type");$$("#userId").val(d),$$("#orderNo").val(f),$$("#orderId").val(g),$$("#orderPay").val(h),$$("#orderMoneyStrLi").html("￥"+h+"元"),$$("#orderPayStrLi").html("￥"+h+"元"),$$("#userCouponId").val(i),$$("#userCouponValue").val(j),$$("#userCouponValueStr").html(j+"元"),$$.ajax({type:"GET",url:siteAPIPath+"user/get_userinfo.json?user_id="+d,dataType:"json",cache:!0,async:!1,success:function(a){var b=a.data.rest_money;$$("#restMoney").val(b),$$("#restMoneyStr").html("余额"+b+"元")}});var l=0,m=isWeiXin();m?($$("#select-wxpay").css("display","block"),$$("#select-alipay").css("display","none"),$$("#img-restpay").attr("src","img/dingdan-pay/dingdan-pay2.png"),$$("#img-alipay").attr("src","img/dingdan-pay/dingdan-pay2.png"),$$("#img-wxpay").attr("src","img/dingdan-pay/dingdan-pay1.png"),$$("#orderPayType").val(2)):($$("#select-wxpay").css("display","none"),$$("#select-alipay").css("display","block"),$$("#img-restpay").attr("src","img/dingdan-pay/dingdan-pay2.png"),$$("#img-wxpay").attr("src","img/dingdan-pay/dingdan-pay2.png"),$$("#img-alipay").attr("src","img/dingdan-pay/dingdan-pay1.png"),$$("#orderPayType").val(1));var n=function(a,b,c){$$("#orderPaySubmit").removeAttr("disabled");var d=JSON.parse(a.response);if("999"==d.status)return void myApp.alert(d.msg);if(l=d.data.pay_type,orderType=d.data.order_type,e=d.data.service_type,3==k&&(f=d.data.order_no_ext,g=d.data.id,sessionStorage.setItem("order_id_ext",g),sessionStorage.setItem("order_no_ext",f)),0==l&&(sessionStorage.removeItem("user_coupon_id"),sessionStorage.removeItem("user_coupon_value"),sessionStorage.removeItem("user_coupon_name"),mainView.router.loadPage("order/order-pay-success.html?service_type_id="+e)),1==l){var h=d.data.order_pay,i=localUrl+"/"+appName+"/pay/alipay_order_api.jsp";i+="?orderNo="+f,i+="&orderPay="+h,i+="&orderType="+orderType,i+="&serviceTypeId="+e,i+="&payOrderType="+k,location.href=i}if(2==l){var j=$$("#userCouponId").val();void 0==j&&(j=0);var m=localUrl+"/"+appName+"/wx-pay-pre.jsp";m+="?orderId="+g,m+="&userCouponId="+j,m+="&orderType=0",m+="&payOrderType="+k,m+="&serviceTypeId="+e,location.href=m}};$$("#orderPaySubmit").click(function(){$$("#orderPaySubmit").attr("disabled",!0),0==k&&b(),3==k&&c()})}),myApp.onPageBeforeInit("order-rate-staff",function(a){function b(a){var b={},c="order/get_staff_total_rate.json";b.staff_id=a,$$.ajax({type:"GET",url:siteAPIPath+c,dataType:"json",cache:!0,data:b,statusCode:{200:d,400:ajaxError,500:ajaxError}})}var c=(localStorage.user_id,a.query.staff_id),d=function(a,b,c){var d=JSON.parse(a.response),e=d.data;if(void 0==e||""==e)return!1;for(var f=$$("#staffTotalRateTemplate").html(),g="",h=0;h<e.length;h++){var i=e[h],j=f;j=j.replace(new RegExp("{staffName}","gm"),i.name),j=j.replace(new RegExp("{age}","gm"),i.age),j=j.replace(new RegExp("{skill}","gm"),i.skill),j=j.replace(new RegExp("{hukou}","gm"),i.hukou),j=j.replace(new RegExp("{totalArrival}","gm"),i.total_arrival),j=j.replace(new RegExp("{intro}","gm"),i.intro),j=j.replace(new RegExp("{staffId}","gm"),i.staff_id);var k=i.head_img,l='<img src="'+k+'" alt="">';j=j.replace(new RegExp("{headImg}","gm"),l);var m="",n=i.total_rate_star;if(n>0)for(var h=1;h<=5;h++)m+=h<=n?'<img src="img/yudingayi/xx.png" alt="">':'<img src="img/yudingayi/xx1.png" alt="">';j=j.replace(new RegExp("{totalRateStar}","gm"),m),g+=j}$$("#staffTotalRate").html(g)};b(c)}),myApp.onPageBeforeInit("order-rate-success",function(a){function b(b,c){var d=a.query.staff_id,f={},g="order/get_order_rate.json";f.user_id=b,f.order_id=c,f.staff_id=d,$$.ajax({type:"GET",url:siteAPIPath+g,dataType:"json",cache:!0,data:f,statusCode:{200:e,400:ajaxError,500:ajaxError}})}var c=localStorage.user_id,d=sessionStorage.getItem("order_id");null!=d&&""!=d&&void 0!=d||(d=a.query.order_id);var e=(sessionStorage.getItem("order_type"),function(a,b,c){var d=JSON.parse(a.response),e=d.data;if(void 0==e||""==e)return!1;for(var f=$$("#staffRateTemplate").html(),g="",h=0;h<e.length;h++){var i=e[h],j=f;j=j.replace(new RegExp("{staffName}","gm"),i.name),j=j.replace(new RegExp("{age}","gm"),i.age),j=j.replace(new RegExp("{skill}","gm"),i.skill),j=j.replace(new RegExp("{hukou}","gm"),i.hukou),j=j.replace(new RegExp("{totalArrival}","gm"),i.total_arrival),j=j.replace(new RegExp("{intro}","gm"),i.intro),j=j.replace(new RegExp("{staffId}","gm"),i.staff_id);var k=i.head_img,l='<img src="'+k+'" alt="">';j=j.replace(new RegExp("{headImg}","gm"),l);var m="",n=i.total_rate_star;if(n>0)for(var h=1;h<=5;h++)m+=h<=n?'<img src="img/yudingayi/xx.png" alt="">':'<img src="img/yudingayi/xx1.png" alt="">';j=j.replace(new RegExp("{totalRateStar}","gm"),m),g+=j}$$("#staffRate").html(g)});b(c,d)}),myApp.onPageBeforeInit("order-rate",function(a){var b=localStorage.user_id,c=sessionStorage.getItem("order_id"),d=(sessionStorage.getItem("staff_names"),sessionStorage.getItem("order_no")),e=sessionStorage.getItem("order_type"),f={};f.order_no=d,0==e?$$.ajax({type:"GET",url:siteAPIPath+"order/order_hour_detail.json",dataType:"json",data:f,cache:!0,async:!1,success:function(a){var b="";list=a.data.order_dispatchs,$$.each(list,function(a,c){b+='<a href="order/order-rate-staff.html?staff_id='+c.staff_id+'">'+c.staff_name+"</a>&nbsp;"}),$$("#staffNameStr").html(b)}}):1==e&&$$.ajax({type:"GET",url:siteAPIPath+"order/get_exp_clean_order_detail.json",dataType:"json",data:f,cache:!0,async:!1,success:function(a){var b="";list=a.data.order_dispatchs,$$.each(list,function(a,c){b+='<a href="order/order-rate-staff.html?staff_id='+c.staff_id+'">'+c.staff_name+"</a>&nbsp;"}),$$("#staffNameStr").html(b)}}),$$("#orderId").val(c),$$("#rateAttitude").val(0),$$("#rateSkill").val(0),$$("#rateContent").keydown(function(){var a=$$("#rateContent").val().length;if(a>=253){var b=$$("#rateContent").val().substr(0,254);$$("#rateContent").val(b)}}),$$("#rateSubmit").on("click",function(){var a=$$("#rateArrival").val(),d=$$("#rateAttitude").val(),e=$$("#rateSkill").val();if(""==a)return myApp.alert("请评价到达时间."),!1;if(""==d||0==d)return myApp.alert("请评价服务态度."),!1;if(""==e||0==e)return myApp.alert("请评价服务技能."),!1;var f={};f.user_id=b,f.order_id=c,f.rate_arrival=$$("#rateArrival").val(),f.rate_attitude=$$("#rateAttitude").val(),f.rate_skill=$$("#rateSkill").val();var g=$$("#rateContent").val();void 0==g&&(g=""),f.rate_content=g,$$.ajax({type:"POST",url:siteAPIPath+"order/post_rate.json",dataType:"json",cache:!0,async:!1,data:f,success:function(a){var b=a.status;return"999"==b?(myApp.alert(a.msg),!1):void mainView.router.loadPage("order/order-rate-success.html")}})})}),myApp.onPageBeforeInit("order-user-rate",function(a){function b(a,b){var c={},d="order/get_user_rates.json";c.user_id=a,c.page=b,$$.ajax({type:"GET",url:siteAPIPath+d,dataType:"json",cache:!0,data:c,statusCode:{200:e,400:ajaxError,500:ajaxError}})}removeSessionData();var c=localStorage.user_id,d=!1,a=$$("#page").val(),e=function(b,c,e){for(var f=JSON.parse(b.response),g=f.data,h=$$("#order-user-rate-temp").html(),i="",j=0;j<g.length;j++){var k=g[j],l=h;if(null!=k.staff_list){for(var m="",n="",o=k.staff_list,p=o.length,q=k.order_id,r=0;r<p;r++)m+="<a href='order/order-rate-success.html?order_id="+q+"&staff_id="+o[r].staff_id+"'><span class='special-color2'>"+o[r].name+"</span></a>",
r<2&&(n+="<a href='order/order-rate-success.html?order_id="+q+"&staff_id="+o[r].staff_id+"'><div id='staffId-img' class='waiter10-2-1'><img src='"+o[r].head_img+"' alt='' /></div></a>");l=l.replace(new RegExp("{staff_name}","gm"),m),l=l.replace(new RegExp("{head_img}","gm"),n)}else l=l.replace(new RegExp("{staff_name}","gm"),"");l=l.replace(new RegExp("{service_type_name}","gm"),k.service_type_name),l=l.replace(new RegExp("{service_date_str}","gm"),k.service_date_str),l=""!=k.rate_content&&null!=k.rate_content?l.replace(new RegExp("{rate_content}","gm"),k.rate_content):l.replace(new RegExp("{rate_content}","gm"),"暂无评价");var s="";0==k.rate_arrival?s="<span class='waiter10-3-1'>准时</span><span class='waiter10-3-2'>迟到</span></li>":1==k.rate_arrival&&(s="<span class='waiter10-3-2'>准时</span><span class='waiter10-3-1'>迟到</span></li>"),l=l.replace(new RegExp("{rate_arrival}","gm"),s);var t="";if(k.rate_attitude>0)for(var u=1;u<=5;u++)t+=u<=k.rate_attitude?'<img src="img/yudingayi/xx.png" alt="">':'<img src="img/yudingayi/xx1.png" alt="">';l=l.replace(new RegExp("{rate_attitude}","gm"),t);var v="";if(k.rate_attitude>0)for(var w=1;w<=5;w++)v+=w<=k.rate_attitude?'<img src="img/yudingayi/xx.png" alt="">':'<img src="img/yudingayi/xx1.png" alt="">';l=l.replace(new RegExp("{rate_skill}","gm"),v);var x="";if(null!=k.order_rate_url){for(var y=k.order_rate_url.length,z=0;z<y;z++)z<4&&(x+="<div class='waiter10-4-1'><img src='"+k.order_rate_url[z]+"' alt=''></div>");l=l.replace(new RegExp("{rate_url}","gm"),x)}else l=l.replace(new RegExp("{rate_url}","gm"),"");i+=l}1==a?$$("#order-user-rate").html(i):$$("#order-user-rate").append(i),d=!1,$$("#page").val(a),g.length>=10?$$("#order-list-more").css("display","block"):$$("#order-list-more").css("display","none")};$$("#order-list-more").on("click",function(){var d=++a;b(c,d)}),b(c,a),$$("#order-user-rate .waiter10-1 #staffId").on("click",function(){alert();var a=$$("#staff_id").val();sessionStorage.setItem("staff_id",a),mainView.router.loadPage("order/order-rate-success.html")}),$$("").on("click",function(){alert();var a=$$("#staff_id").val();sessionStorage.setItem("staff_id",a),mainView.router.loadPage("order/order-rate-success.html")})}),myApp.onPageInit("order-view-0",function(a){}),myApp.template7Data["page:order-view-0"]=function(){var a,b={},c=sessionStorage.getItem("order_no");return b.order_no=c,$$.ajax({type:"GET",url:siteAPIPath+"order/order_hour_detail.json",dataType:"json",data:b,cache:!0,async:!1,success:function(b){a=b.data}}),a},myApp.onPageInit("order-view-1",function(a){}),myApp.template7Data["page:order-view-1"]=function(){var a,b={},c=sessionStorage.getItem("order_no");return b.order_no=c,$$.ajax({type:"GET",url:siteAPIPath+"order/get_exp_clean_order_detail.json",dataType:"json",data:b,cache:!0,async:!1,success:function(b){a=b.data}}),a},myApp.onPageInit("cook-page",function(a){var b=a.query.firstServiceType;$$("#parentServiceType").val(b),$$(document).on("click","#cook-div",function(){var a=localStorage.user_id;if(void 0==a||0==a.length)return myApp.alert("您还没有登录"),mainView.router.loadPage("login.html"),!1;var b=$$(this).find("input[name='enable']").val();if(0==b)return!1;var c=$$(this).find("input[name='serviceTypeId']").val(),d=$$(this).find("input[name='serviceProperty']").val(),e="order/order-form-zhongdiangong.html?serviceType="+c+"&parentServiceTypeId=24";1==d&&(localStorage.setItem("service_type_id",c),e="order/fiveservice/QuanNianDingZhi.html?serviceType="+c),mainView.router.loadPage(e)}),$$("#cook-banner").on("click",function(){24==b&&mainView.router.loadPage("order/service-introduce/service-chuniang.html")})}),myApp.template7Data["page:cook-page"]=function(){var a,b=24;return $$.ajax({type:"GET",url:siteAPIPath+"newPartServiceType/second_service_type.json?service_type_id="+b,dataType:"json",cache:!0,async:!1,success:function(b){a=b}}),a},myApp.onPageInit("jinpaibaojie-page",function(a){var b=a.query.firstServiceType;$$("#parentServiceType").val(b),$$(document).on("click","#jinpaibaojiediv",function(){var a=localStorage.user_id;if(void 0==a||0==a.length)return myApp.alert("您还没有登录"),mainView.router.loadPage("login.html"),!1;var b=$$(this).find("input[name='enable']").val();if(0==b)return!1;var c=$$(this).find("input[name='serviceTypeId']").val(),d=$$(this).find("input[name='serviceProperty']").val(),e="order/order-form-zhongdiangong.html?serviceType="+c+"&parentServiceTypeId=23";1==d&&(localStorage.setItem("service_type_id",c),e="order/fiveservice/QuanNianDingZhi.html?serviceType="+c),mainView.router.loadPage(e)}),$$("#jinpaibaojie-banner").on("click",function(){23==b&&mainView.router.loadPage("order/service-introduce/service-jinpai.html")})}),myApp.template7Data["page:jinpaibaojie-page"]=function(){var a,b=23;return $$.ajax({type:"GET",url:siteAPIPath+"newPartServiceType/second_service_type.json?service_type_id="+b,dataType:"json",cache:!0,async:!1,success:function(b){a=b}}),a},myApp.template7Data["page:qiyefuwu-page"]=function(){var a,b=localStorage.firstServiceType;return $$.ajax({type:"GET",url:siteAPIPath+"newPartServiceType/second_service_type.json",data:{service_type_id:b},dataType:"json",cache:!0,async:!1,success:function(b){a=b}}),a},myApp.onPageInit("qiyefuwu-page",function(a){var b=localStorage.firstServiceType;$$("#parentServiceTypeId").val(b),$$("div[name='tiexinjiashidiv']").on("click",function(){var a=localStorage.user_id;if(void 0==a||0==a.length)return myApp.alert("您还没有登录"),mainView.router.loadPage("login.html"),!1;var b=$$(this).find("input[name='enable']").val();if(0==b)return!1;var c=$$(this).find("input[name='serviceTypeId']").val();localStorage.setItem("am_faqiyuyue_service_type_id",c),localStorage.setItem("am_faqiyuyue_parent_service_type_id",localStorage.firstServiceType),mainView.router.loadPage("order/order-am-faqiyuyue.html")}),$$("#qiye-banner").on("click",function(){27==b&&mainView.router.loadPage("order/service-introduce/service-qiye.html")})}),myApp.onPageInit("quanniandingzhi-page",function(a){var b=a.query.serviceType;void 0!=b&&$$("#serviceTypeId").val(b),$$("#submitAtOnce").on("click",function(){var a=$$("#serviceTypeId").val(),b=localStorage.user_id;return void 0==b?(myApp.alert("您还没有登录"),mainView.loadPage.router("login.html"),!1):void $$.ajax({type:"get",url:siteAPIPath+"order/order_customiza_year.json",data:{service_type_id:a,user_id:b},success:function(a,b,c){var d=JSON.parse(a);return"999"==d.status?(myApp.alert(d.msg),!1):(myApp.alert(d.msg),void mainView.router.loadPage("index.html"))}})})}),myApp.template7Data["page:quanniandingzhi-page"]=function(){var a,b=localStorage.service_type_id;return $$.ajax({type:"GET",url:siteAPIPath+"newPartServiceType/service_type_detail.json?service_type_id="+b,dataType:"json",cache:!0,async:!1,success:function(b){a=b.data}}),a},myApp.template7Data["page:tiexinjiashi-page"]=function(){var a,b=localStorage.firstServiceType;return $$.ajax({type:"GET",url:siteAPIPath+"newPartServiceType/second_service_type.json",data:{service_type_id:b},dataType:"json",cache:!0,async:!1,success:function(b){a=b}}),a},myApp.onPageInit("tiexinjiashi-page",function(a){var b=localStorage.firstServiceType;$$("#parentServiceTypeId").val(b),$$("div[name='tiexinjiashidiv']").on("click",function(){var a=localStorage.user_id;if(void 0==a||0==a.length)return myApp.alert("您还没有登录"),mainView.router.loadPage("login.html"),!1;var b=$$(this).find("input[name='enable']").val();if(0==b)return!1;var c=$$(this).find("input[name='serviceTypeId']").val();localStorage.setItem("am_faqiyuyue_service_type_id",c),localStorage.setItem("am_faqiyuyue_parent_service_type_id",localStorage.firstServiceType),mainView.router.loadPage("order/order-am-faqiyuyue.html")}),$$("#tiexinjiashi-banner").on("click",function(){25==b&&mainView.router.loadPage("order/service-introduce/service-tiexin.html"),26==b&&mainView.router.loadPage("order/service-introduce/service-shendu.html")})}),myApp.onPageBeforeInit("mine-add-addrs",function(a){var b=localStorage.user_id;addrId=a.query.addr_id;var c=a.query.return_url;if($$("#mine-addr-save").removeAttr("disabled"),void 0!=b&&""!=b&&0!=b){void 0!=addrId&&""!=addrId||(addrId=0),void 0!=c&&""!=c||(c="user/mine-addr-list.html"),$$("#user_id").val(b),$$("#addr_id").val(addrId);var d=function(a,b,d){myApp.hideIndicator(),$$("#mine-addr-save").removeAttr("disabled");var e=JSON.parse(a.response);return"999"==e.status?void myApp.alert(e.msg):(1==e.data.is_default&&(localStorage.default_addr_id=e.data.id,localStorage.default_addr_name=e.data.name+" "+e.data.addr),void mainView.router.loadPage(c))};$$("#mine-addr-save").on("click",function(){if($$("#mine-addr-save").attr("disabled",!0),0==addrFormValidation())return $$("#mine-addr-save").removeAttr("disabled"),!1;var a=myApp.formToJSON("#addr-form");$$.ajax({type:"POST",url:siteAPIPath+"user/post_user_addrs.json",dataType:"json",cache:!1,data:a,statusCode:{200:d,400:ajaxError,500:ajaxError}})})}}),myApp.template7Data["page:mine-addr-list"]=function(){var a,b=localStorage.user_id;return $$.ajax({type:"GET",url:siteAPIPath+"user/get_user_addrs.json?user_id="+b,dataType:"json",cache:!0,async:!1,success:function(b){null==localStorage.default_addr_id&&$$.each(b,function(a,b){if(1==b.is_default)return localStorage.default_addr_id=b.id,localStorage.default_addr_name=b.name+" "+b.addr,!1}),a=b}}),a},myApp.onPageInit("mine-addr-list",function(a){localStorage.user_id;$$(".all-button9").on("click",function(){mainView.router.loadPage("user/mine-add-addr.html?addr_id=0")})}),myApp.template7Data["page:mine-charge-list"]=function(){var a,b=localStorage.getItem("user_id");return null!=b&&void 0!=b||(b=0),$$.ajax({type:"GET",url:siteAPIPath+"/dict/get_cards.json?user_id="+b,dataType:"json",cache:!0,async:!1,success:function(b){a=b}}),a},myApp.onPageInit("mine-charge-list",function(a){$$(".charge-way").on("click",function(){var a=$$(this).next("#id").val();null==a&&""==a||(sessionStorage.setItem("card_id",a),mainView.router.loadPage("user/charge/mine-charge-way.html?card_id="+a))})}),myApp.onPageBeforeInit("mine-charge-pay-success",function(a){var b=localStorage.getItem("user_id"),c=function(a,b,c){myApp.hideIndicator();var d=JSON.parse(a.response);if("999"==d.status)return void myApp.alert(a.msg);var e=d.data;localStorage.setItem("is_vip",e.is_vip)};$$.ajax({type:"get",url:siteAPIPath+"user/getUserRestMoneyInfo.json?user_id="+b,dataType:"json",cache:!1,statusCode:{200:c,400:ajaxError,500:ajaxError}})}),myApp.onPageBeforeInit("mine-charge-way",function(a){var b=localStorage.getItem("user_id"),c=a.query.card_id,d=2;if(localStorage.removeItem("pay_card_id"),void 0!=b&&""!=b&&0!=b){$$("#mobile").text(localStorage.getItem("user_mobile"));var e=function(a,b,c){var e=JSON.parse(a.response);if("999"==e.status)return void myApp.alert(e.msg);var f=e.data.id;if(2==d){var g=localUrl+"/"+appName+"/wx-pay-pre.jsp";g+="?orderId="+f,g+="&userCouponId=0",g+="&orderType=4",g+="&payOrderType=1",location.href=g}};$$("#chongzhi-submit").click(function(){var a={};a.user_id=b,a.card_type=c,a.pay_type=2,a.staff_code=$$("#staffCode").val(),$$.ajax({type:"post",url:siteAPIPath+"user/card_buy.json",data:a,statusCode:{200:e,400:ajaxError,500:ajaxError}})})}}),myApp.template7Data["page:mine-charge-way"]=function(){var a,b=sessionStorage.getItem("card_id");return $$.ajax({type:"GET",url:siteAPIPath+"dict/get_card_detail.json?card_id="+b,dataType:"json",cache:!0,async:!1,success:function(b){a=b.data}}),a},myApp.onPageInit("mine-feed-back-info",function(a){var b=localStorage.getItem("user_id");void 0!=b&&""!=b&&0!=b&&$$(".feed-back-info-submit").on("click",function(){var a=$$("#service_content").val();return""==a||void 0==a?void myApp.alert("请输入您的意见详情！"):a.length>100?void myApp.alert("只能输入100个字"):void saveUserFeedBack(b)})});var saveUserFeedBackSuccess=function(a,b,c){var d=JSON.parse(a.response);return"999"==d.status?void myApp.alert(d.msg):(myApp.alert("您的意见我们已经收到，感谢您的反馈!"),void mainView.router.loadPage("user/mine.html"))};myApp.onPageInit("mine-rest-money-detail-page",function(a){function b(a,b){var c={},d="user/pay_detail_list.json";c.user_id=a,c.page=b,$$.ajax({type:"GET",url:siteAPIPath+d,dataType:"json",cache:!0,data:c,statusCode:{200:e,400:ajaxError,500:ajaxError}})}var c=localStorage.user_id,d=!1,a=$$("#page").val(),e=function(b,c,e){for(var f=JSON.parse(b.response),g=f.data,h=$$("#rest-detail-list-part").html(),i="",j=0;j<g.length;j++){var k=g[j],l=h,m=k.order_type,n="";0==m||2==m||3==m?n='<img src="img/laonian/jianhao.png" alt="" class="all-img7">':1==m&&(n='<img src="img/laonian/jiahao.png" alt="" class="all-img7">'),l=l.replace(new RegExp("{detailImg}","gm"),n),l=l.replace(new RegExp("{orderTypeName}","gm"),k.order_type_name),l=l.replace(new RegExp("{orderPay}","gm"),k.order_pay),l=l.replace(new RegExp("{addTimeStr}","gm"),k.add_time_str),i+=l}1==a?$$("#rest-detail-list").html(i):$$("#rest-detail-list").append(i),d=!1,$$("#page").val(a),g.length>=10?$$("#pay-detail-list-more").css("display","block"):$$("#pay-detail-list-more").css("display","none")};$$("#pay-detail-list-more").on("click",function(){var d=++a;b(c,d)}),b(c,a)}),myApp.onPageBeforeInit("mine",function(a){var b=localStorage.getItem("user_id");void 0!=b&&""!=b&&0!=b&&($$("#mine-coupons").on("click",function(){mainView.router.loadPage("user/user-coupons.html?user_id="+b)}),$$("#mine-about-us").on("click",function(){mainView.router.loadPage("user/aboutus.html")}),$$("#mine-issue").on("click",function(){mainView.router.loadPage("user/faq.html")}),$$("#mine-addr-manager").on("click",function(){mainView.router.loadPage("user/mine-addr-list.html?user_id="+b)}),$$("#mine-agreement").on("click",function(){mainView.router.loadPage("user/agreement.html")}),$$("#user-logout").on("click",function(){localStorage.removeItem("mobile"),localStorage.removeItem("user_id"),localStorage.removeItem("is_vip"),localStorage.removeItem("im_username"),localStorage.removeItem("im_password"),localStorage.removeItem("am_id"),localStorage.removeItem("am_mobile"),localStorage.removeItem("default_addr_id"),localStorage.removeItem("default_addr_name"),removeSessionData(),mainView.router.loadPage("index.html")}))}),myApp.template7Data["page:mine"]=function(){var a="",b=localStorage.getItem("user_id");if(void 0!=b&&""!=b&&0!=b)return $$.ajax({type:"GET",url:siteAPIPath+"user/get_userinfo.json?user_id="+b,dataType:"json",cache:!0,async:!1,success:function(b){a=b.data,localStorage.setItem("is_vip",a.is_vip)}}),a},myApp.onPageBeforeInit("mine-more",function(a){var b=localStorage.getItem("user_id");void 0!=b&&""!=b&&0!=b&&($$("#mine-faq").on("click",function(){mainView.router.loadPage("user/faq.html")}),$$("#mine-agreement").on("click",function(){mainView.router.loadPage("user/agreement.html")}),$$("#mine-aboutus").on("click",function(){mainView.router.loadPage("user/aboutus.html")}))}),myApp.onPageInit("mine-coupons-list",function(a){var b=localStorage.getItem("user_id");if(void 0!=b&&""!=b&&0!=b){var c=a.query.back_url,d=sessionStorage.getItem("service_type_id"),e=sessionStorage.getItem("order_money");null!=d&&""!=d&&void 0!=d&&$$(document).on("click","#mine-coupons-use",function(a){if(a.stopImmediatePropagation(),""!=c){var b=$$(this).find(".service_type").val(),f=$$(this).find("#user_coupon_id").val(),g=$$(this).find("#user_coupon_value").val(),h=$$(this).find("#max_value").val(),i="￥"+g,j=$$(this).find("#from_date").val(),k=$$(this).find("#to_date").val(),l=1e3*sessionStorage.getItem("service_date");if(b>0&&b.indexOf(d)<0)return myApp.alert("当前优惠劵不适用!"),!1;if(parseFloat(e)<parseFloat(h))return myApp.alert("当前优惠劵不适用!"),!1;if(l<=j||l>=k)return myApp.alert("当前优惠劵不适用!"),!1;sessionStorage.setItem("user_coupon_id",f),sessionStorage.setItem("user_coupon_name",i),sessionStorage.setItem("user_coupon_value",g),mainView.router.loadPage(c)}})}}),myApp.template7Data["page:mine-coupons-list"]=function(){var a="",b=localStorage.getItem("user_id");return $$.ajax({type:"GET",url:siteAPIPath+"user/get_coupon.json?user_id="+b,dataType:"json",cache:!0,async:!1,success:function(b){a=b}}),a},myApp.onPageBeforeInit("user-wancheng",function(a){var b=localStorage.getItem("user_id");void 0!=b&&""!=b&&0!=b&&(getMineInfos(b),$$("#user_mine_submit").on("click",function(){$$("#user_mine_submit").attr("disabled",!0);var a=myApp.formToJSON("#user_wancheng");$$.ajax({type:"POST",url:siteAPIPath+"user/post_user_info.json?user_id="+b,dataType:"json",cache:!1,data:a,statusCode:{200:saveUserSuccess,400:ajaxError,500:ajaxError}})}))});var onMineInfoSuccess=function(a,b,c){var d=JSON.parse(a.response);if("999"==d.status)return void myApp.alert(d.msg);var e=d.data;$$("#user_mobile_span").text(e.mobile);var f={name:e.name};myApp.formFromJSON("#user_wancheng",f)};myApp.onPageInit("survey-question-page",function(a){if(void 0==localStorage.survey_user_id)return myApp.alert("请您发起新的订制服务"),mainView.router.loadPage("survey-user.html"),!1;var b={},c=a.query.q_id;void 0==c&&(c=0),b.q_id=c;var d=function(a,b,c){var d=JSON.parse(a.response),e=d.data,f=e.option_list,g=$$("#questionTemplate").html();g=g.replace(new RegExp("{questionId}","gm"),e.q_id),0==e.is_multi&&(g=g.replace(new RegExp("{questionTitle}","gm"),e.title)),1==e.is_multi&&(g=g.replace(new RegExp("{questionTitle}","gm"),"(多选)"+e.title)),g=g.replace(new RegExp("{isFirst}","gm"),e.is_first),$$("#questionDisplay").html(""),$$("#questionDisplay").append(g);var h="";h=0===e.is_multi?$$("#optionTemplateRadio").html():$$("#optionTemplateCheckbox").html();for(var i="",j=0;j<f.length;j++){var k=h;k=k.replace(new RegExp("{optionNo}","gm"),f[j].no),k=k.replace(new RegExp("{optionStr}","gm"),f[j].title),i+=k}$$("#optionDisplay").html(""),$$("#optionDisplay").append(i),2===e.is_first&&($$("#nextDiv").hide(),$$("#endDiv").show())};$$.ajax({type:"get",url:siteAPIPath+"survey/load_question.json",data:b,statusCode:{200:d,400:ajaxError,500:ajaxError}}),$$("#nextQuestion").on("click",function(){var a=generateSurveyResultOption();if(0==a)return!1;localStorage.surveyResult;$$.ajax({type:"get",url:siteAPIPath+"survey/load_question.json",data:a,statusCode:{200:d,400:ajaxError,500:ajaxError}})}),$$("#endQuestion").on("click",function(){var a=generateSurveyResultOption();if(0==a)return!1;var b="survey/survey-result.html";mainView.router.loadPage(b)})}),myApp.onPageInit("survey-result-child-page",function(a){if(void 0==localStorage.survey_user_id)return myApp.alert("请您发起新的订制服务"),mainView.router.loadPage("index.html"),!1;var b=localStorage.changeContentId;$$("#contentId").val(b);var c={};c.content_id=b,$$.ajax({type:"get",url:siteAPIPath+"survey/get_child_content_list.json",data:c,success:function(a,c,d){var e=JSON.parse(a),f=e.data,g=$$("#childContentTemplate").html(),h="";if(null!=localStorage.boxChildContent&&localStorage.boxChildContent.length>0)for(var i=JSON.parse(localStorage.boxChildContent),j=0;j<i.length;j++){var k=i[j],l=k.baseContentId;if(b==l){for(var m=k.childBoxArray,n=0,o=m.length;n<o;n++)for(var p=m[n],j=0,q=f.length;j<q;j++){var r=f[j];if(r.id==p.boxChildContentId){var s=p.boxChildContentTimes;r.option_str=r.option_str.replace(/\d+/g,s)}}break}}for(var j=0;j<f.length;j++){var r=f[j],t=g,u=r.option_str.match(/\d/g).join(""),v=r.option_str.substring(0,r.option_str.indexOf(u));t=t.replace(new RegExp("{contentName}","gm"),v),t=t.replace(new RegExp("{id}","gm"),r.id),t=t.replace(new RegExp("{number}","gm"),u),h+=t}$$("#childDisplay").append(h)},error:function(){myApp.alert("网络错误")}}),$$("#confirmChangeTimes").on("click",function(){var a=[],b=[];$$("#childDisplay").find("input[id='childContentId']").each(function(a,c){var d=$$(this).val(),e=$$(this).parent().find("#item_num").val(),f={boxChildContentId:d,boxChildContentTimes:e};b.push(f)});var c=$$("#contentId").val(),d={baseContentId:c,childBoxArray:b};if(a.push(d),null!=localStorage.boxChildContent&&localStorage.boxChildContent.length>0){for(var e=JSON.parse(localStorage.boxChildContent),f=0;f<e.length;f++)for(var g=e[f],h=0;h<a.length;h++){var d=a[h];g.contentId==d.contentId&&e.baoremove(f)}localStorage.setItem("boxChildContent",JSON.stringify(a.concat(e)))}else localStorage.setItem("boxChildContent",JSON.stringify(a));myApp.showPreloader("调整成功！"),setTimeout(function(){myApp.hidePreloader()},500),mainView.router.loadPage("survey/survey-result.html")})}),Array.prototype.baoremove=function(a){return!(isNaN(a)||a>this.length)&&void this.splice(a,1)},myApp.onPageInit("survey-result-price-page",function(a){localStorage.removeItem("storeBaseArray"),localStorage.removeItem("storeRadioArray");var b=localStorage.survey_user_id;if(void 0==b)return myApp.alert("请您发起新的定制服务"),mainView.router.loadPage("index.html"),!1;var c={};c.user_id=b,$$.ajax({type:"get",url:siteAPIPath+"survey/get_result_price.json",data:c,success:function(a,b,c){var d=JSON.parse(a),e=d.data[0];$$("#sumPrice").text(e.sum_price),$$("#discountPrice").text(e.discount_price),$$("#monthPrice").text(e.price_by_month),$$("#yearRadio").val(e.survey_pay_type),$$("#yearDiscountPrice").val(e.discount_price),$$("#yearPriceByMonth").val(e.price_by_month);var f=d.data[1];$$("#quarterDiscountPrice").val(f.discount_price),$$("#quarterPriceByMonth").val(f.price_by_month),$$("#quarterRadio").val(f.survey_pay_type);var g=d.data[2];$$("#monthDiscountPrice").val(g.discount_price),$$("#monthPriceByMonth").val(g.price_by_month),$$("#monthRadio").val(g.survey_pay_type)},error:function(){myApp.alert("网络异常")}}),$$("select[name='payTypeSelect']").on("change",function(){var a=$$(this).val();0==a&&($$("#discountPrice").text($$("#yearDiscountPrice").val()),$$("#monthPrice").text($$("#yearPriceByMonth").val())),1==a&&($$("#discountPrice").text($$("#quarterDiscountPrice").val()),$$("#monthPrice").text($$("#quarterPriceByMonth").val())),2==a&&($$("#discountPrice").text($$("#monthDiscountPrice").val()),$$("#monthPrice").text($$("#monthPriceByMonth").val()))}),$$("#completeSurvey").on("click",function(){localStorage.removeItem("boxChildContent"),localStorage.removeItem("surveyResult"),localStorage.removeItem("survey_user_id"),localStorage.removeItem("changeContentId"),mainView.router.loadPage("survey/survey-success.html")})}),myApp.onPageInit("survey-result-page",function(a){function b(a){var b=$$(a).find("font").text();"展开"==b?$$(a).find("font").text("收起"):$$(a).find("font").text("展开")}if(void 0==localStorage.survey_user_id)return myApp.alert("请您发起新的定制服务"),mainView.router.loadPage("survey/survey-user.html"),!1;var c=function(a,b,c){var d=JSON.parse(a.response),e=d.data,f=e[0],g=e[1],h=e[2],i=($$("#childRadioUl").html(),$$("#childCheckboxUl").html(),localStorage.storeBaseArray),j=localStorage.storeRadioArray;if(void 0!=i)for(var k=JSON.parse(i),l=0;l<k.length;l++){for(var m=k[l],n=0;n<f.length;n++){var o=f[n];m.baseContentId==o.content_id&&(0!=o.base_content_real_time?o.base_content_real_time=m.baseContentTimes:o.default_time=m.baseContentTimes)}for(var n=0;n<g.length;n++){var p=g[n];m.baseContentId==p.content_id&&(0!=p.base_content_real_time?p.base_content_real_time=m.baseContentTimes:p.default_time=m.baseContentTimes)}}if(void 0!=j)for(var q=JSON.parse(j),l=0;l<q.length;l++){for(var r=q[l],n=0;n<f.length;n++){var o=f[n];r.baseContentId==o.content_id&&(o.child_list[0].default_time_child=r.childRadioArray[0].childRadioContentTimes)}for(var n=0;n<g.length;n++){var p=g[n];r.baseContentId==p.content_id&&(p.child_list[0].default_time_child=r.childRadioArray[0].childRadioContentTimes)}}for(var s="",t=$$("ul[id='baseContentTemplate']").html(),n=0;n<f.length;n++){var u=f[n],v=t,w=u.base_content_real_time,x=generateTimeWordForTimes(u.measurement);if(1==u.content_child_type){var y=u.child_list[0].id;v=v.replace(new RegExp("{childRadioContentId}","gm"),y);var z=u.child_list[0].default_time_child;v=v.replace(new RegExp("{defaultTimes}","gm"),z+x)}2==u.content_child_type&&(v=v.replace(new RegExp("{defaultTimes}","gm"),"1"+x)),0==u.content_child_type&&(v=0==w?v.replace(new RegExp("{defaultTimes}","gm"),u.default_time+x):v.replace(new RegExp("{defaultTimes}","gm"),w+x)),v=v.replace(new RegExp("{contentName}","gm"),u.name),v=v.replace(new RegExp("{price}","gm"),u.price),v=v.replace(new RegExp("{contentId}","gm"),u.content_id),v=v.replace(new RegExp("{contentChildType}","gm"),u.content_child_type),v=v.replace(new RegExp("{serviceColor}","gm"),"button button-fill service-button1"),v=v.replace(new RegExp("{serviceChangeButtonColor}","gm"),"button button-fill service-button"),s+=v}$$("#baseDisplay").append(s);for(var A="",B=$$("ul[id='baseContentTemplate']").html(),n=0;n<g.length;n++){var C=g[n],v=B,x=generateTimeWordForTimes(C.measurement);if(1==C.content_child_type){var y=C.child_list[0].id;v=v.replace(new RegExp("{childRadioContentId}","gm"),y);var z=C.child_list[0].default_time_child;v=v.replace(new RegExp("{defaultTimes}","gm"),z+x)}2==C.content_child_type&&(v=v.replace(new RegExp("{defaultTimes}","gm"),"1"+x)),0==C.content_child_type&&(v=0==C.default_time?v.replace(new RegExp("{defaultTimes}","gm"),"1"+x):v.replace(new RegExp("{defaultTimes}","gm"),C.default_time+x)),v=v.replace(new RegExp("{contentName}","gm"),C.name),v=v.replace(new RegExp("{price}","gm"),C.price),v=v.replace(new RegExp("{contentId}","gm"),C.content_id),v=v.replace(new RegExp("{contentChildType}","gm"),C.content_child_type),v=v.replace(new RegExp("{serviceColor}","gm"),"button button-fill service-button2"),v=v.replace(new RegExp("{serviceChangeButtonColor}","gm"),"button button-fill service-button2"),A+=v}$$("#recommendDisplay").append(A);for(var D="",E=$$("ul[id='freeContentTemplate']").html(),n=0;n<h.length;n++){var F=h[n],v=E;v=v.replace(new RegExp("{contentName}","gm"),F.name),D+=v}return $$("#freeDisplay").append(D),myApp.accordionOpen("#baseAccordionItem"),!1},d={};d.survey_user_id=localStorage.survey_user_id,d.survey_result=localStorage.surveyResult,$$.ajax({type:"post",url:siteAPIPath+"survey/survey_result.json",data:d,statusCode:{200:c,400:ajaxError,500:ajaxError}}),$$("#submitResult").on("click",function(){$$(this).attr("disabled",!0),storeNowData();var a={};return a.base_content_array=localStorage.storeBaseArray,a.radio_content_array=localStorage.storeRadioArray,void 0!=localStorage.boxChildContent?(a.box_content_array=localStorage.boxChildContent,a.default_box_content_array="[]"):(a.default_box_content_array=localStorage.storeChildBoxArray,a.box_content_array="[]"),a.user_id=localStorage.survey_user_id,void 0==localStorage.survey_user_id?(myApp.alert("请勿重复提交"),mainView.router.loadPage("index.html"),!1):void $$.ajax({type:"post",url:siteAPIPath+"survey/submit_survey_result.json",data:a,success:function(a,b,c){var d=JSON.parse(a);return"999"==d.status?(myApp.alert(d.msg),!1):($$("#submitResult").removeAttr("disabled"),void mainView.router.loadPage("survey/survey-result-price.html"))},error:function(){myApp.alert("网络错误")}})}),$$(".accordion-item").on("open",function(){b(this)}),$$(".accordion-item").on("close",function(a){b(this)})}),myApp.onPageInit("survey-user-page",function(a){$$("#submitSurveyUser").click(function(){if(0==surveyUserValidation())return!1;var a=myApp.formToJSON("#survey-user-form");$$.ajax({type:"post",url:siteAPIPath+"survey/survey_user_submit.json",data:a,success:function(a,b,c){var d=JSON.parse(a);if("999"==d.status)return myApp.alert(resut.msg),!1;localStorage.setItem("survey_user_id",d.data);var e="survey/survey-question.html";mainView.router.loadPage(e)},error:function(a,b){myApp.alert("网络异常,请稍后再试.")}})})});