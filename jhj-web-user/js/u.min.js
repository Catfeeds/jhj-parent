function initHomePage(){var a;return $$.ajax({type:"GET",url:siteAPIPath+"indexAd/get_ad_list.json",dataType:"json",cache:!0,async:!1,success:function(b){a=b;for(var c=a.data,d="",e=0;e<c.length;e++){var f=c[e];""!=f.img_url&&(f=localUrl+f.img_url,d+='<div class="swiper-slide"style="height:150px;"><img src="'+f+'"></div>')}""==d&&(d='<div class="swiper-slide"style="height:150px;"><img src="img/tmp/13.png"></div>');var g='<div class="swiper-wrapper" id="swiper-list">';g+=d,g+='</div><div class="swiper-pagination"></div>',$$(".swiper-container").html(g);myApp.swiper(".swiper-container",{pagination:".swiper-pagination",autoplay:2e3})}}),a}function orderAmFormValidation(){$$("#order-am-faqiyuyue").removeAttr("disabled");var a=myApp.formToJSON("#order-am-faqiyuyue-form");return void 0==a.service_content||""==a.service_content?(myApp.alert("请输入服务内容"),$$("#order-am-faqiyuyue").removeAttr("disabled"),!1):!0}function formValidation(){var a=myApp.formToJSON("#orderHour-Form"),b=a.serviceDate,c=moment(b).format("HH"),d=moment(b).format("YYYYMMDD"),e=moment().format("YYYYMMDD"),f=a.serviceHour,g=/[\u4E00-\u9FA5]/g,h=f.replace(g,""),i=moment().hour();if(Number(c)<=i&&d==e)return alert("现在时间："+moment().format("YYYY-MM-DD HH:MM ")+"\r\n请选择合适的服务时间"),!1;if(Number(c)+Number(h)>21)return alert("超过21点，无法提供服务"),!1;var j=$$("#addrName").html();return"请选择服务地址"==j?(alert("请选择服务地址"),!1):""==a.serviceHour?(alert("请选择服务时长"),!1):!0}function hrefToUorderView(a,b){localStorage.setItem("u_order_no_param",b),mainView.router.loadPage("order/order-view-"+a+".html?order_no="+b)}function saveExpCleanOrderSuccess(a,b,c){$$("#order-exp-clean-submit").removeAttr("disabled"),myApp.hideIndicator();var d=JSON.parse(a.response);if("999"==d.status)return void myApp.alert(d.msg);if("0"==d.status){var e=d.data.order_no;localStorage.getItem("user_id");mainView.router.loadPage("order/order-list-shendubaojie-result.html?order_no="+e),localStorage.setItem("u_order_no_param",e),sessionStorage.removeItem("service_date")}}function orderFormValidation(){var a=myApp.formToJSON("#order-exp-clean-form");""==a.service_date&&myApp.alert("请输入服务时间");var b=a.service_date,c=moment(b).format("HH");return Number(c)<6?(alert("现在无法下单，点击选择合适 的时间"),$$("#order-exp-clean-submit").removeAttr("disabled"),!1):""==a.addr_id?(myApp.alert("请输入服务地址"),$$("#order-exp-clean-submit").removeAttr("disabled"),!1):!0}function jumpDetail(a){localStorage.setItem("socials_id",a),mainView.router.loadPage("huodong-detail.html")}function baiduAutoCompleteSuccess(a,b,c){var d=JSON.parse(a.response),e=d.data;e.length>0&&$$("#addr-auto-list ul").html("");var f=$$("#autocomplete-list-part-li").html(),g="";$$.each(e,function(a,b){if(void 0!=b.location){var c=f;c=c.replace(new RegExp("{item_name}","gm"),b.name),c=c.replace(new RegExp("{item_lat}","gm"),b.location.lat),c=c.replace(new RegExp("{item_lng}","gm"),b.location.lng),c=c.replace(new RegExp("{item_city}","gm"),b.city),c=c.replace(new RegExp("{item_uid}","gm"),b.uid),g+=c}}),$$("#addr-auto-list ul").append(g)}function getBaiduAutoComplete(){var a={};a.query=$$("#name").val(),a.region="131",a.output="json",a.ak="2sshjv8D4AOoOzozoutVb6WT",$$.ajax({type:"GET",url:siteAPIPath+"map/autocomplete.json",dataType:"json",cache:!0,contentType:"application/x-www-form-urlencoded; charset=utf-8",data:a,statusCode:{200:baiduAutoCompleteSuccess,400:ajaxError,500:ajaxError},success:function(){}})}function selectAddr(a){var b=a.find("li"),c=b.find("input[name=item_lat]"),d=b.find("input[name=item_lng]"),e=b.find("input[name=item_city]"),f=b.find("input[name=item_uid]"),g=b.find("div[class*=item-title]"),h=d.val(),i=c.val(),j=e.val(),k=g.html(),l=f.val();$$("#name").val(k),$$("#longitude").val(h),$$("#latitude").val(i),$$("#city").val(j),$$("#uid").val(l),$$("#addr-auto-list ul").html("")}function addrFormValidation(){var a=myApp.formToJSON("#addr-form");return""==a.name?(myApp.alert("请输入小区名或大厦名，并在下拉列表中选择。"),!1):""==a.longitude||""==a.latitude?(myApp.alert("请输入小区名或大厦名，并在下拉列表中选择。"),!1):""==a.addr?(myApp.alert("请输入详细门牌号"),!1):!0}function setAddrDefault(a){var b=localStorage.user_id,c={};c.user_id=b,c.addr_id=a,$$.ajax({type:"POST",url:siteAPIPath+"user/post_set_addr_default.json",data:{user_id:b,addr_id:a},success:function(){$$(".swipeout").each(function(b,c){var d=$$(this).find("input[type=radio]"),e=$$(this).find(".item-title"),f=e.html();a==d.val()?f.indexOf("默认")<0&&e.html("[默认] "+f):e.html(f.replace("[默认] ","")),myApp.swipeoutClose($$(this))})}})}function chargeLargeValue(a){var b=(localStorage.getItem("am_id"),localStorage.getItem("am_mobile"));null==localStorage.getItem("am_id")||null==localStorage.getItem("am_mobile")?myApp.confirm("您还没有添加地址，点击确定前往添加地址立刻获得家庭助理，点击返回留在此页","",function(){mainView.router.loadPage("user/mine-add-addr.html?addr_id=0&return_url=user/charge/mine-charge-list.html")}):myApp.confirm("土豪,大额充值可联系您的助理为您上门办理。确定拨打助理电话:"+b,"",function(){$$("#cal_am_mobile_real").attr("href","tel:"+b),$$("#cal_am_mobile_real").click()})}function exchangeUserCoupon(a){var b=$$("#cardPasswdItem").val();return""==b||b.length<0?void myApp.alert("兑换码不能为空"):void $$.ajax({type:"POST",url:siteAPIPath+"user/post_coupon.json",data:{user_id:a,card_passwd:b},dataType:"json",cache:!1,statusCode:{200:onExchangeSuccess,400:ajaxError,500:ajaxError}})}function saveUserFeedBack(a){var b={};b.user_id=a,b.content=$$("#service_content").val(),$$.ajax({type:"POST",url:siteAPIPath+"user/post_feed_back.json",dataType:"json",cache:!0,data:b,statusCode:{200:saveUserFeedBackSuccess,400:ajaxError,500:ajaxError}})}function getUserInfos(a){var b={};b.user_id=a,$$.ajax({type:"GET",url:siteAPIPath+"user/get_userinfo.json",dataType:"json",cache:!0,data:b,statusCode:{200:onUserInfoSuccess,400:ajaxError,500:ajaxError}})}function saveUserSuccess(a,b,c){$$("#user_mine_submit").removeAttr("disabled"),myApp.hideIndicator();var d=JSON.parse(a.response);return"999"==d.status?void myApp.alert(d.msg):void("0"==d.status&&mainView.router.loadPage("user/mine.html"))}function getMineInfos(a){var b={};b.user_id=a,$$.ajax({type:"GET",url:siteAPIPath+"user/get_userinfo.json",dataType:"json",cache:!0,data:b,statusCode:{200:onMineInfoSuccess,400:ajaxError,500:ajaxError}})}initHomePage(),$$(document).on("pageBeforeInit",function(a){var b=a.detail.page;"index"===b.name&&initHomePage()}),myApp.onPageInit("login",function(a){$$("#get_code").on("click",function(a){function b(){$$("#get_code").attr("disabled",!0),$$("#get_code").css("background","#999"),$$("#get_code").text(e+"秒"),0==e&&($$("#get_code").removeAttr("disabled"),$$("#get_code").css("background","#f37b1d"),$$("#get_code").text("获取验证码"),clearInterval(f)),e--}var c=$$("#user_mobile").val();if(void 0==c||""==c)return myApp.alert("请填写手机号。"),!1;var d=c.trim();if(11!=d.length)return myApp.alert("请填写正确的手机号码"),!1;var e=60,f=setInterval(b,1e3),g={};g.mobile=d,g.sms_type=0,$$.ajax({url:siteAPIPath+"user/get_sms_token.json",contentType:"application/x-www-form-urlencoded; charset=utf-8",type:"GET",dataType:"json",cache:!0,data:g,statusCode:{201:h,400:ajaxError,500:ajaxError}});var h=function(a,b,c){myApp.hideIndicator(),myApp.alert("验证码已发送到您的手机，请注意查收。")};return!1}),$$("#login_btn").on("click",function(a){var b=$$("#user_mobile").val(),c=$$("#verify_code").val();if(""==b||""==c)return myApp.alert("请填写手机号或验证码。"),!1;if(11!=b.length)return myApp.alert("请填写正确的手机号码"),!1;var d=function(a,b,c){myApp.hideIndicator();var d=JSON.parse(a.response);if("999"==d.status)return void myApp.alert(d.msg);"0"==d.status&&(localStorage.user_mobile=d.data.mobile,localStorage.user_id=d.data.id,localStorage.im_username=d.data.im_user_name,localStorage.im_password=d.data.im_password);var e=d.data.has_user_addr;if(1==e){var f=mainView.history[mainView.history.length-2];mainView.router.loadPage(f)}else mainView.router.loadPage("user/mine-add-addr.html")},e={};return e.mobile=b,e.sms_token=c,e.login_from=1,e.user_type=2,$$.ajax({type:"POST",url:siteAPIPath+"user/login.json",dataType:"json",cache:!0,data:e,statusCode:{200:d,201:d,400:ajaxError,500:ajaxError}}),!1}),$$(".yanzheng1").click(function(){$$(".login-tishi1").css("display","block")})}),myApp.onPageBeforeInit("order-am-faqiyuyue-page",function(a){function b(a,b,d){$$("#order-am-faqiyuyue").attr("disabled",!1);var e=JSON.parse(a.response);if("999"==e.status)return void myApp.alert(e.msg);var f=e.data,g=f.order_no;mainView.router.loadPage("order/order-am-result.html?user_id="+c+"&order_no="+g)}var c=localStorage.getItem("user_id"),d=a.query.service_type,e=JSON.parse(localStorage.getItem("service_type_list"));$$.each(e,function(a,b){b.id==d&&($$("#servce_type_name").append(b.name),$$("#service_type_tips").append(b.tips))}),$$("#order-am-faqiyuyue").on("click",function(){if(0==orderAmFormValidation())return!1;var a=$$("#service_content").val();$$.ajax({type:"POST",url:siteAPIPath+"order/post_user.json",dataType:"json",cache:!1,data:{user_id:c,service_type:d,service_content:a,order_from:1},statusCode:{200:b,400:ajaxError,500:ajaxError}})}),$$("#service_content").click(function(){$$("#myContent").css("padding","10px")})}),myApp.onPageInit("order-am-page",function(a){var b=JSON.parse(localStorage.getItem("service_type_list")),c=$$("#order-am-part").html(),d="";$$.each(b,function(a,b){if(b.id>=3){var e=c,f='<img src="img/icons/service_type_img_'+b.id+'.png" alt=""> ';e=e.replace(new RegExp("{img_tag}","gm"),f),e=e.replace(new RegExp("{id}","gm"),b.id),e=e.replace(new RegExp("{name}","gm"),b.name),e=e.replace(new RegExp("{tips}","gm"),b.tips),d+=e}}),$$(".order-am-list ul").append(d)}),myApp.onPageInit("orderHour-pay-page",function(a){var b=localStorage.user_id,c=localStorage.order_no,d=localStorage.order_id,e=0,f=$$("#orderStatus").val(),g=$$("#orderMoney").text(),h=delSomeString(g);localStorage.setItem("u_order_money_param",h);var i=$$("#orderType").val();if(3==f){$$("#selectCoupon").click(function(){var a="user/coupon/mine-coupon-list.html";a+="?order_type="+i,a+="&order_money="+h,mainView.router.loadPage(a)});var j=a.query.user_coupon_id,k=a.query.user_coupon_name,l=a.query.user_coupon_value;if(void 0!=j&&void 0!=k){$$("#user_coupon_id").val(j),$$("#couponSelect").html("为您节省了"+l+"元"),void 0==l&&(l=0);var m=parseFloat(h)-parseFloat(l);0>=m&&(m=0),$$("#real-order-money-label").html("￥"+m)}}$$("label[name=myPayTypeSelect]").on("click",function(){var a=$$(this).find("input").val();$$('img[name="order_pay_type"]').each(function(b,c){$$(this).prev().val()==a?$$(this).attr("src","img/icons/duigou-green.png"):$$(this).attr("src","img/icons/duigou-grey.png")})});var n=function(a,b,f){$$(".zf-hour-submit").removeAttr("disabled");var g=JSON.parse(a.response);if("999"==g.status)return myApp.alert(g.msg),void $$(".zf-hour-submit").attr("disabled",!0);if(0==e&&mainView.router.loadPage("order/order-pay-success.html?order_no="+c+"&order_type=0"),2==e){var h=$$("#user_coupon_id").val();void 0==h&&(h=0);var i=localUrl+"/"+appName+"/wx-pay-pre.jsp";i+="?orderId="+d,i+="&userCouponId="+h,i+="&orderType=0",i+="&payOrderType=0",location.href=i}};$$(".zf-hour-submit").click(function(){$$(".zf-hour-submit").attr("disabled",!0);var a={};a.user_id=b,a.order_no=c;var d=$$("#user_coupon_id").val();void 0==d&&(d=0),a.user_coupon_id=d,$$('img[name="order_pay_type"]').each(function(a,b){$$(this).attr("src").indexOf("green")>0&&(e=$$(this).prev().val())}),a.order_pay_type=e,$$.ajax({type:"post",url:siteAPIPath+"order/post_pay.json",data:a,statusCode:{200:n,400:ajaxError,500:ajaxError}})})}),myApp.template7Data["page:orderHour-pay-page"]=function(){var a,b={},c=localStorage.order_no;return b.order_no=c,$$.ajax({type:"GET",url:siteAPIPath+"order/order_hour_detail.json",dataType:"json",data:b,cache:!0,async:!1,success:function(b){a=b.data;var c=moment.unix(a.service_date),d=c.format("YYYY-MM-DD HH:mm");a.service_date=d}}),a},myApp.onPageInit("order-form-zhongdiangong-page",function(a){function b(){i=$$("#price").attr("value"),h=$$("#serviceAddons").attr("value"),$$("img[name = tag]").each(function(a,b){$$(this).attr("src").indexOf("-2x")>0&&(h=h+$$(this).prev().val()+",",i=Number(i)+Number($$(this).next().attr("value")))}),""!=h&&(h=h.substring(0,h.length-1)),$$("#price").html(i+"元/小时,两小时起")}var c=localStorage.user_id;$$("#userId").val(c);var d=a.query.addr_id,e=a.query.addr_name;void 0!=d&&$$("#addrId").val(d),void 0!=e&&$$("#addrName").html(e),dateSelect();var f=sessionStorage.getItem("serviceDate");null!=f&&$$("#serviceDate").val(f);var g=sessionStorage.getItem("sumPrice");isNaN(g)||((""==g||null==g)&&(g=30),$$("#price").html(g+"元/小时,两小时起"));var h="",i="";$$("img[src$='.png']").on("click",function(a){var c=$$(this).attr("src").split(".");c[0].endWith("-2x")?$$(this).attr("src",c[0].replace("-2x","")+".png"):$$(this).attr("src",c[0]+"-2x.png"),b()}),$$("#submitOrder").click(function(){if(0==formValidation())return!1;b();var a=myApp.formToJSON("#orderHour-Form");a.serviceAddons=h,a.serviceDate=moment(a.serviceDate+":00","yyyy-MM-DD HH:mm:ss").unix(),$$.ajax({type:"post",url:siteAPIPath+"order/post_hour.json",data:a,success:function(a,b,d){var e=JSON.parse(a);if("999"==e.status)return void myApp.alert(e.msg);localStorage.setItem("user_id",c),localStorage.setItem("order_no",e.data.order_no),localStorage.setItem("order_id",e.data.id),sessionStorage.removeItem("serviceDate"),sessionStorage.removeItem("sumPrice"),sessionStorage.removeItem("serviceAddons"),myApp.formDeleteData("orderHour-Form");var f="order/order-form-zhongdiangong-pay.html";mainView.router.loadPage(f)},error:function(a,b){alert("网络异常,请稍后再试.")}})});for(var j=JSON.parse(localStorage.getItem("service_type_addons_list")),k=0;k<j.length;k++){var l=j[k];"做饭"==l.name&&($$("#zuofanPrice").val(l.price),$$("#zuofanId").val(l.service_addon_id)),"洗衣"==l.name&&($$("#xiyiPrice").val(l.price),$$("#xiyiId").val(l.service_addon_id)),"清洁用品"==l.name&&($$("#qingjiePrice").val(l.price),$$("#qingjieId").val(l.service_addon_id))}var m=sessionStorage.getItem("serviceAddons");null!=m&&$$("img[name = tag]").each(function(a,b){var c=$$(this).prev().val(),d=$$(this).attr("src").split(".");m.indexOf(c)>=0&&$$(this).attr("src",d[0]+"-2x.png")}),$$("#addrSelect").on("click",function(){sessionStorage.setItem("serviceDate",$$("#serviceDate").val());var a="",b=$$("#price").attr("value");$$("img[name = tag]").each(function(c,d){$$(this).attr("src").indexOf("-2x")>0&&(a=h+$$(this).prev().val()+",",b=Number(b)+Number($$(this).next().attr("value")))}),sessionStorage.setItem("serviceAddons",a),sessionStorage.setItem("sumPrice",b)})}),String.prototype.endWith=function(a){var b=this.length-a.length;return b>=0&&this.lastIndexOf(a)==b},myApp.onPageBeforeInit("order-get-rate-page",function(a){var b=a.query.order_id;$$.ajax({type:"GET",url:siteAPIPath+"order/get_rate.json?order_id="+b,dataType:"json",cache:!0,success:function(a,b,c){for(var d=a.data,e="",f=($$("#order-am-clean-part").html(),d.list),g=0;g<f.length;g++){var h=f[g];e=h.rate_content,rateType=h.rate_type,rateValue=h.rate_value,0==rateType&&$$("img[name=order_type_0_img]").each(function(a,b){$$(this).attr("value")==rateValue?$$(this).attr("src","img/icons/shi-x.png"):$$(this).attr("src","img/icons/shi.png")}),1==rateType&&$$("img[name=order_type_1_img]").each(function(a,b){$$(this).attr("value")==rateValue?$$(this).attr("src","img/icons/shi-x.png"):$$(this).attr("src","img/icons/shi.png")}),2==rateType&&$$("img[name=order_type_2_img]").each(function(a,b){$$(this).attr("value")==rateValue?$$(this).attr("src","img/icons/shi-x.png"):$$(this).attr("src","img/icons/shi.png")}),3==rateType&&$$("img[name=order_type_3_img]").each(function(a,b){var c=$$(this).attr("value");c==rateValue?(0==rateValue&&$$(this).attr("src","img/icons/henbang-x.png"),1==rateValue&&$$(this).attr("src","img/icons/yiban-x.png"),2==rateValue&&$$(this).attr("src","img/icons/jiaocha-x.png")):(0==c&&$$(this).attr("src","img/icons/henbang.png"),1==c&&$$(this).attr("src","img/icons/yiban.png"),2==c&&$$(this).attr("src","img/icons/jiaocha.png"))}),4==rateType&&$$("img[name=order_type_4_img]").each(function(a,b){var c=$$(this).attr("value");c==rateValue?(0==rateValue&&$$(this).attr("src","img/icons/henbang-x.png"),1==rateValue&&$$(this).attr("src","img/icons/yiban-x.png"),2==rateValue&&$$(this).attr("src","img/icons/jiaocha-x.png")):(0==c&&$$(this).attr("src","img/icons/henbang.png"),1==c&&$$(this).attr("src","img/icons/yiban.png"),2==c&&$$(this).attr("src","img/icons/jiaocha.png"))})}$$("#rateContent").text(e),$$("#rateType").text(rateType),$$("#rateValue").text(rateValue)}})}),myApp.onPageBeforeInit("order-hour-now-list-page",function(a){var b={},a=1,c=localStorage.user_id,d=!1,e="order/orderHourNowList.json";b.user_id=c,b.page=a;var f=function(b,c,e){for(var f=JSON.parse(b.response),g=f.data,h=$$("#order-hour-list").html(),i="",j=0;j<g.length;j++){var k=g[j],l=h;l=l.replace(new RegExp("{order_type}","gm"),k.order_type),l=l.replace(new RegExp("{order_no}","gm"),k.order_no),l=l.replace(new RegExp("{order_hour_type_name}","gm"),k.order_hour_type_name),l=l.replace(new RegExp("{order_hour_status_name}","gm"),k.order_hour_status_name),l=2==k.order_type?l.replace(new RegExp("{service_date}","gm"),moment.unix(k.add_time).format("YYYY-MM-DD HH:mm")):l.replace(new RegExp("{service_date}","gm"),moment.unix(k.service_date).format("YYYY-MM-DD HH:mm")),l=l.replace(new RegExp("{address}","gm"),k.address),i+=l}return $$("#card-hour-now-list ul").append(i),a+=1,d=!1,g.length<10?void $$("#order-list-more").css("display","none"):void 0};b.user_id=c,b.page=a,$$.ajax({type:"GET",url:siteAPIPath+e,dataType:"json",cache:!0,data:b,statusCode:{200:f,400:ajaxError,500:ajaxError}}),$$("#order-list-more").on("click",function(){d||(d=!0,b.user_id=c,b.page=a,$$.ajax({type:"GET",url:siteAPIPath+e,dataType:"json",cache:!0,data:b,timeout:1e4,statusCode:{200:f,400:ajaxError,500:ajaxError}}))}),$$("#btn-order-now").on("click",function(){if("dangqian-box active-state"!=$$(this).attr("class")){$$(this).attr("class","dangqian-box"),$$("#btn-order-history").attr("class","history-box"),e="order/orderHourNowList.json",$$("#order-list-more").css("display","block"),$$("#card-hour-now-list ul").html(""),a=1;var b={};b.user_id=c,b.page=a,$$.ajax({type:"GET",url:siteAPIPath+"order/orderHourNowList.json",dataType:"json",cache:!0,data:b,statusCode:{200:f,400:ajaxError,500:ajaxError}})}}),$$("#btn-order-history").on("click",function(){if("history-box1 active-state"!=$$(this).attr("class")){$$(this).attr("class","history-box1"),$$("#btn-order-now").attr("class","dangqian-box1"),e="order/orderHourOldList.json",$$("#order-list-more").css("display","block"),$$("#card-hour-now-list ul").html(""),a=1;var b={};b.user_id=c,b.page=a,$$.ajax({type:"GET",url:siteAPIPath+"order/orderHourOldList.json",dataType:"json",cache:!0,data:b,statusCode:{200:f,400:ajaxError,500:ajaxError}})}})}),myApp.onPageInit("order-pay-success-page",function(a){var b=a.query.order_no,c=a.query.order_type;0==c&&($$("#blackContent").text("订单支付成功!"),$$("#grayContent").text("我们正在为您安排服务人员")),1==c&&($$("#blackContent").text("订单支付成功!"),$$("#grayContent").text("服务人员即将为您服务")),2==c&&($$("#blackContent").text("订单支付成功!"),$$("#grayContent").text("您的助理会按约定时间为您服务")),$$("#order-pay-success-btn").click(function(){var a="";0==c&&(a="order/order-view-0.html"),1==c&&(a="order/order-view-1.html"),2==c&&(a="order/order-view-2.html"),localStorage.setItem("u_order_no_param",b),a+="?order_no="+b,mainView.router.loadPage(a)})}),myApp.onPageBeforeInit("order-rate-page",function(a){var b=localStorage.getItem("user_id"),c=a.query.order_id;$$("img[name=order_type_0_img]").on("click",function(a){var b=$$(this).attr("value");$$("img[name=order_type_0_img]").each(function(a,c){$$(this).attr("value")==b?$$(this).attr("src","img/icons/shi-x.png"):$$(this).attr("src","img/icons/shi.png")}),$$("#rate_type_0").val(b)}),$$("img[name=order_type_1_img]").on("click",function(a){var b=$$(this).attr("value");$$("img[name=order_type_1_img]").each(function(a,c){$$(this).attr("value")==b?$$(this).attr("src","img/icons/shi-x.png"):$$(this).attr("src","img/icons/shi.png")}),$$("#rate_type_1").val(b)}),$$("img[name=order_type_2_img]").on("click",function(a){var b=$$(this).attr("value");$$("img[name=order_type_2_img]").each(function(a,c){$$(this).attr("value")==b?$$(this).attr("src","img/icons/shi-x.png"):$$(this).attr("src","img/icons/shi.png")}),$$("#rate_type_2").val(b)}),$$("img[name=order_type_3_img]").on("click",function(a){var b=$$(this).attr("value");$$("img[name=order_type_3_img]").each(function(a,c){var d=$$(this).attr("value");d==b?(0==b&&$$(this).attr("src","img/icons/henbang-x.png"),1==b&&$$(this).attr("src","img/icons/yiban-x.png"),2==b&&$$(this).attr("src","img/icons/jiaocha-x.png")):(0==d&&$$(this).attr("src","img/icons/henbang.png"),1==d&&$$(this).attr("src","img/icons/yiban.png"),2==d&&$$(this).attr("src","img/icons/jiaocha.png"))}),$$("#rate_type_3").val(b)}),$$("img[name=order_type_4_img]").on("click",function(a){var b=$$(this).attr("value");$$("img[name=order_type_4_img]").each(function(a,c){var d=$$(this).attr("value");d==b?(0==b&&$$(this).attr("src","img/icons/henbang-x.png"),1==b&&$$(this).attr("src","img/icons/yiban-x.png"),2==b&&$$(this).attr("src","img/icons/jiaocha-x.png")):(0==d&&$$(this).attr("src","img/icons/henbang.png"),1==d&&$$(this).attr("src","img/icons/yiban.png"),2==d&&$$(this).attr("src","img/icons/jiaocha.png"))}),$$("#rate_type_4").val(b)});var d=function(a,b,c){myApp.hideIndicator();var d=JSON.parse(a.response);return"999"==d.status?(myApp.alert(d.msg),void $$("#pingjia-submit").attr("disabled",!0)):void("0"==d.status&&(myApp.alert("订单评价完成"),mainView.router.loadPage("order/order-hour-now-list.html")))};$$("#pingjia-submit").on("click",function(){var a={},e=$$("#rate_type_0").val(),f=$$("#rate_type_1").val(),g=$$("#rate_type_2").val(),h=$$("#rate_type_3").val(),i=$$("#rate_type_4").val(),j=[{rateType:0,rateValue:e},{rateType:1,rateValue:f},{rateType:2,rateValue:g},{rateType:3,rateValue:h},{rateType:4,rateValue:i}];a.user_id=b,a.order_id=c,a.rate_content=$$("#rateContents").val(),a.rate_datas=JSON.stringify(j),$$.ajax({type:"POST",url:siteAPIPath+"order/post_rate.json",dataType:"json",cache:!1,data:a,statusCode:{200:d,400:ajaxError,500:ajaxError}})})}),myApp.onPageInit("order-hour-view-0-page",function(a){var b=localStorage.user_id,c=a.query.order_no,d=$$("#orderStatus").val();3==d&&$$("#u1  li:nth-child(odd)").css("background-color","#EF7C00"),4==d&&($$("#u1  li:nth-child(odd)").css("background-color","#EF7C00"),$$("#u2  li:nth-child(odd)").css("background-color","#EF7C00")),5==d&&($$("#u1  li:nth-child(odd)").css("background-color","#EF7C00"),$$("#u2  li:nth-child(odd)").css("background-color","#EF7C00"),$$("#u3  li:nth-child(odd)").css("background-color","#EF7C00")),6==d&&($$("#u1  li:nth-child(odd)").css("background-color","#EF7C00"),$$("#u2  li:nth-child(odd)").css("background-color","#EF7C00"),$$("#u3  li:nth-child(odd)").css("background-color","#EF7C00")),7==d&&($$("#u1  li:nth-child(odd)").css("background-color","#EF7C00"),$$("#u2  li:nth-child(odd)").css("background-color","#EF7C00"),$$("#u3  li:nth-child(odd)").css("background-color","#EF7C00"),$$("#u4  li:nth-child(odd)").css("background-color","#EF7C00"),$$("#u5  li:nth-child(odd)").css("background-color","#EF7C00"));var e=$$("#orderType").val(),f=delSomeString($$("#orderMoney").text());if(3==d){$$("#user_coupon_view_li").hide(),$$("#order_pay_view_li").hide(),$$("#hour-pay-submit").show(),$$(".hour-pay-coupon-select").show(),$$(".hour-pay-type-choose").show(),$$("#selectCoupon").click(function(){var a="user/coupon/mine-coupon-list.html";a+="?order_type="+e,a+="&order_money="+f,mainView.router.loadPage(a)});var g=a.query.user_coupon_id,h=a.query.user_coupon_name,i=a.query.user_coupon_value;if(void 0!=g&&void 0!=h){$$("#user_coupon_id").val(g),$$("#couponSelect").html("为您节省了"+i+"元"),void 0==i&&(i=0);var j=parseFloat(f)-parseFloat(i);0>j&&(j=0),$$("#real-order-money-label").html("￥"+j)}}else $$("#hour-pay-submit").hide(),$$(".hour-pay-coupon-select").hide(),$$(".hour-pay-type-choose").hide(),$$("#user_coupon_view_li").show(),$$("#order_pay_view_li").show();3==d||4==d?$$("#cancleOrder").show():$$("#cancleOrder").hide(),6==d?$$("#rate").show():$$("#rate").hide(),7==d?$$("#getRate").show():$$("#getRate").hide();var k=function(a,b,d){$$("#hour-pay-submit").removeAttr("disabled");var e=JSON.parse(a.response);if("999"==e.status)return myApp.alert(e.msg),void $$(".zf-hour-submit").attr("disabled",!0);0==orderPayType&&mainView.router.loadPage("order/order-pay-success.html?order_no="+c+"&order_type=0");var f=$$("#orderId").val();if(2==orderPayType){var g=$$("#user_coupon_id").val();void 0==g&&(g=0);var h=localUrl+"/"+appName+"/wx-pay-pre.jsp";h+="?orderId="+f,h+="&userCouponId="+g,h+="&orderType=1",h+="&payOrderType=0",location.href=h}};$$("label[name=myPayTypeSelect]").on("click",function(){var a=$$(this).find("input").val();$$('img[name="order_pay_type"]').each(function(b,c){$$(this).prev().val()==a?$$(this).attr("src","img/icons/duigou-green.png"):$$(this).attr("src","img/icons/duigou-grey.png")})}),$$("#hour-pay-submit").click(function(){$$("#hour-pay-submit").attr("disabled",!0);var a=$$("#user_coupon_id").val();void 0==a&&(a=0);var d={};d.user_id=b,d.order_no=c,d.user_coupon_id=a,$$('img[name="order_pay_type"]').each(function(a,b){$$(this).attr("src").indexOf("green")>0&&(orderPayType=$$(this).prev().val())}),d.order_pay_type=orderPayType,$$.ajax({type:"post",url:siteAPIPath+"order/post_pay.json",data:d,statusCode:{200:k,400:ajaxError,500:ajaxError}})}),$$("#rate").on("click",function(){if(7==d)return myApp.alert("您已经评价过啦"),!1;var a=$$("#orderId").val();mainView.router.loadPage("order/order-rate.html?order_id="+a)}),$$("#getRate").on("click",function(){var a=$$("#orderId").val();mainView.router.loadPage("order/order-get-rate.html?order_id="+a)}),$$("#cancleOrder").on("click",function(){var a={};a.order_no=c;var b="",d=$$("#serviceDate").text(),e=(new Date(d).getTime()/1e3).toString(),f=Math.round((new Date).getTime()/1e3),g=Number(e)-Number(f);b=7200>=g&&g>0?"服务已经快开始了，现在取消订单会扣除全部费用哦，确定取消吗?":"现在取消订单，订单金额会全部退到您的账号余额，确定取消订单吗?",myApp.confirm(b,function(){$$.ajax({type:"post",url:siteAPIPath+"order/cancle_am_order.json",data:a,cache:!0,success:function(a,b,c){var d=JSON.parse(a);return 0==d.status&&(myApp.alert("订单取消成功！"),mainView.router.loadPage("order/order-hour-now-list.html")),999==d.status?(myApp.alert(d.msg),$$("#cancleOrder").attr("disabled",!0),!1):void 0}})})})}),myApp.template7Data["page:order-hour-view-0-page"]=function(){var a,b={},c=localStorage.u_order_no_param;return b.order_no=c,$$.ajax({type:"GET",url:siteAPIPath+"order/order_hour_detail.json",dataType:"json",data:b,cache:!0,async:!1,success:function(b){a=b.data;var c=moment.unix(a.service_date),d=c.format("YYYY-MM-DD HH:mm");a.service_date=d}}),a},myApp.onPageBeforeInit("order-hour-view-2-page",function(a){var b=localStorage.user_id,c=(a.query.order_no,a.query.order_no),d=0;$$("#selectCoupon").click(function(){var a=$$("#order_type").val(),b=($$("#order_no").val(),$$("#order_money").val()),c="user/coupon/mine-coupon-list.html";c+="?order_type="+a,c+="&order_money="+b,mainView.router.loadPage(c)});var e=a.query.user_coupon_id,f=a.query.user_coupon_value;if(void 0!=e&&void 0!=f){$$("#user_coupon_id").val(e),$$("#user_coupon_name").html("为您节省了"+f+"元"),void 0==f&&(f=0);var g=$$("#order_money").val();$$("#real-am-order-money-label").html(parseFloat(g)-parseFloat(f)+"元")}var h=function(a,b,d){$$("#am-pay-submit").removeAttr("disabled");var e=JSON.parse(a.response);if("999"==e.status)return void myApp.alert(e.msg);var f=e.data,g=f.id;if(0==orderPayType&&mainView.router.loadPage("order/order-pay-success.html?order_no="+c+"&order_type=2"),2==orderPayType){var h=$$("#user_coupon_id").val();void 0==h&&(h=0);var i=localUrl+"/"+appName+"/wx-pay-pre.jsp";i+="?orderId="+g,i+="&userCouponId="+h,i+="&orderType=2",i+="&payOrderType=0",location.href=i}};$$("label[name=myPayTypeSelect]").on("click",function(){var a=$$(this).find("input").val();$$('img[name="order_pay_type"]').each(function(b,c){$$(this).prev().val()==a?$$(this).attr("src","img/icons/duigou-green.png"):$$(this).attr("src","img/icons/duigou-grey.png")})}),$$(".am-pay-submit").click(function(){$$("#am-pay-submit").attr("disabled",!0);var a=$$("#user_coupon_id").val();void 0==a&&(a=0);var d={};d.user_id=b,d.order_no=c,d.user_coupon_id=a,$$('img[name="order_pay_type"]').each(function(a,b){$$(this).attr("src").indexOf("green")>0&&(orderPayType=$$(this).prev().val())}),d.order_pay_type=orderPayType,$$.ajax({type:"post",url:siteAPIPath+"order/post_pay.json",data:d,statusCode:{200:h,400:ajaxError,500:ajaxError}})}),$$("#yonghu-pingjiadingdan").on("click",function(){mainView.router.loadPage("order/order-rate.html?order_id="+d)}),$$("#yonghu-pingjiaxiangqing").on("click",function(){mainView.router.loadPage("order/order-get-rate.html?order_id="+d)})}),myApp.template7Data["page:order-hour-view-2-page"]=function(){var a,b=(localStorage.user_id,localStorage.u_order_no_param),c={};return c.order_no=b,$$.ajax({type:"GET",url:siteAPIPath+"order/order_hour_paotui_detail.json",dataType:"json",data:c,cache:!0,async:!1,success:function(b){a=b.data}}),a},myApp.onPageBeforeInit("order-view-page",function(a){var b=a.query.user_id,c=a.query.order_no;if(void 0!=b&&""!=b&&0!=b){var d=(localStorage.sec_id,function(a,b,c){myApp.hideIndicator();var d=JSON.parse(a.response),e=d.data,f=moment.unix(e.add_time),g=f.format("YYYY-MM-DD HH:mm:ss");$$("#add_time").text(g),$$("#order_status").text(e.order_status_name),0==e.order_pay_type?$$("#order_pay_type").text("无需支付"):$$("#order_pay_type").text("在线支付"),$$("#order_id").val(e.id),$$("#order_no").text(e.order_no),$$("#name-span").text(e.name),$$("#mobile").text(e.mobile),$$("#service_type").text(e.service_type_name),$$("#service_content").text(e.service_content),$$("#order_money").text(e.order_money),(1==e.order_status||3==e.order_status)&&($$("#order-modify").css("display","block"),$$("#order-push").css("display","block"))}),e={};e.user_id=b,e.order_no=c,$$.ajax({type:"GET",url:siteAPIPath+"order/get_detail.json",dataType:"json",cache:!0,data:e,statusCode:{200:d,400:ajaxError,500:ajaxError},success:function(){}}),$$("#order-modify").on("click",function(){mainView.router.loadPage("order/order-form.html?user_id="+b+"&order_no="+c)}),$$("#order-push").on("click",function(){var a=function(a,b,c){myApp.hideIndicator();var d=JSON.parse(a.response);return"999"==d.status?void myApp.alert(d.msg):void("0"==d.status&&myApp.alert("订单推送已完成"))},c={},d=$$("#order_id").val();c.user_id=b,c.order_id=d,$$.ajax({cache:!0,type:"POST",url:siteAPIPath+"order/push_order.json",data:c,statusCode:{200:a,400:ajaxError,500:ajaxError}})})}}),myApp.onPageBeforeInit("order-am-result-page",function(a){var b=a.query.order_no;$$("#order-am-result").on("click",function(){localStorage.setItem("u_order_no_param",b),mainView.router.loadPage("order/order-view-2.html?order_no="+b)})}),myApp.onPageBeforeInit("order-list-shendubaojie-result",function(a){var b=a.query.order_no;$$("#to-shendu-order-detail").on("click",function(){mainView.router.loadPage("order/order-view-1.html?order_no="+b),localStorage.setItem("u_order_no_param",b)})}),myApp.onPageInit("order-list-shendubaojie-yuyue",function(a){var b=a.query.addr_id,c=a.query.addr_name,d=localStorage.getItem("user_id");void 0!=b&&$$("#addr_ids").val(b),void 0!=c&&$$("#addrName").html(c);var e=sessionStorage.getItem("exp_clean_remarks");null!=e&&void 0!=e?$$("#exp_clean_remarks").text(sessionStorage.getItem("exp_clean_remarks")):$$("#exp_clean_remarks").text(sessionStorage.getItem("exp_clean_remarks")),dateSelect();var f=sessionStorage.getItem("service_date");null!=f&&$$("#serviceDate").val(f);var g=localStorage.getItem("tagIds"),h=g.split(","),i=$$("#order_price").val();i=Number(0);for(var j=Number(0),k=0;k<h.length;k++)itemPrice=getServiceAddonPrice(h[k]),j=getServiceAddonDefaultNum(h[k]),void 0!=j&&void 0!=itemPrice&&(i=Number(i)+Number(j)*Number(itemPrice));$$("#order_price").val(i),$$("#order-exp-clean-submit").on("click",function(){
$$("#order-exp-clean-submit").attr("disabled",!0),sessionStorage.setItem("exp_clean_remarks","");var a=localStorage.getItem("tagIds"),b=a.split(",");if(0==orderFormValidation())return!1;for(var c="",e=0;e<b.length;e++){var f=b[e],g=getServiceAddonDefaultNum(b[e]);c+="{",c+="serviceAddonId:"+f+",itemNum:"+g+",",c=c.substring(0,c.length-1)+"},"}var h=c.lastIndexOf(",");c="["+c.substring(0,h)+"]";var i=myApp.formToJSON("#order-exp-clean-form");i.service_date=moment(i.service_date+":00","yyyy-MM-DD HH:mm:ss").unix(),i.service_addons_datas=c,i.user_id=d,i.service_type="2",$$.ajax({type:"POST",url:siteAPIPath+"order/post_exp_clean_order.json",dataType:"json",async:!1,cache:!1,data:i,statusCode:{200:saveExpCleanOrderSuccess,400:ajaxError,500:ajaxError}})}),$$("#addrSelect").on("click",function(){sessionStorage.setItem("service_date",$$("#serviceDate").val());var a=$$("#exp_clean_remarks").val(),b=myApp.formToJSON("#order-exp-clean-form");""!=a&&void 0!=a?(b.remarks=a,sessionStorage.setItem("exp_clean_remarks",a)):(b.remarks="",sessionStorage.setItem("exp_clean_remarks",""))})}),myApp.template7Data["page:order-list-shendubaojie-yuyue"]=function(){for(var a={},b=localStorage.getItem("tagIds"),c=b.split(","),d=JSON.parse(localStorage.getItem("service_type_addons_list")),e=(localStorage.getItem("user_id"),[]),f=0;f<c.length;f++){var g=c[f],h="",i="",j="",k={};$$.each(d,function(a,b){b.service_addon_id==g&&(h=b.name,i=b.item_unit,defaultNum=b.default_num,j=b.price)}),k.name=h,k.item_unit=i,k.default_num=defaultNum,k.price=j,e.push(k)}return a.list=e,a},myApp.onPageBeforeInit("order-list-shendubaojiezl-page",function(a){var b="";$$(".shendu-fl-lb-every").on("click",function(a){var c=$$(this).children().children().attr("src").split(".");c[0].endWith("-x")?($$(this).children().children().attr("src",c[0].replace("-x","")+".png"),$$(this).css("background","#F7F7F7"),$$($$(this).children()).next().css("color","#999")):($$(this).children().children().attr("src",c[0]+"-x.png"),$$(this).css("background","#CACCFD"),$$($$(this).children()).next().css("color","#EF7C00")),b=$$("#serviceAddons").attr("value"),$$("img[name = tag]").each(function(a,c){$$(this).attr("src").indexOf("-x")>0&&(b=b+$$(this).attr("id")+",")}),""!=b&&(b=b.substring(0,b.length-1))}),$$("#shendu-to-form").click(function(){return""!=b&&b.length>0?(mainView.router.loadPage("order/order-list-shendubaojie-yuyue.html"),void localStorage.setItem("tagIds",b)):void myApp.alert("请选择服务种类")})}),myApp.onPageBeforeInit("order-list-shendubaojie-tijiao",function(a){var b=a.query.order_no,c=localStorage.user_id,d=0,e=0,f={};f.order_no=b,$$("#selectCoupon").click(function(){var a=$$("#order_type").val(),b=($$("#order_no").val(),$$("#order_money").val()),c="user/coupon/mine-coupon-list.html";c+="?order_type="+a,c+="&order_money="+b,mainView.router.loadPage(c)});var g=$$("#order_status_span").val();4==g?($$("#user_coupon_view1_li").show(),$$("#order_pay_view1_li").show()):($$("#user_coupon_view1_li").hide(),$$("#order_pay_view1_li").hide());var h=a.query.user_coupon_id,i=a.query.user_coupon_value;if(void 0!=h&&void 0!=i){$$("#user_coupon_id").val(h),$$("#user_coupon_name").html("为您节省了"+i+"元"),void 0==i&&(i=0);var j=$$("#order_money").val(),k=parseFloat(j)-parseFloat(i);0>k&&(k=0),$$("#real-order-money-label-exp-clean").html("￥"+k)}$$("#exp-clean-order-pingjia").on("click",function(){mainView.router.loadPage("order/order-rate.html?order_id="+d)}),$$("#exp-clean-pingjiaxiangqing").on("click",function(){mainView.router.loadPage("order/order-get-rate.html?order_id="+d)}),$$("label[name=myPayTypeSelects]").on("click",function(){var a=$$(this).find("input").val();$$('img[name="order_pay_types"]').each(function(b,c){$$(this).prev().val()==a?$$(this).attr("src","img/icons/duigou-green.png"):$$(this).attr("src","img/icons/duigou-grey.png")})}),$$("#cancle_exp_clean_order_button").on("click",function(){myApp.confirm("您真的要取消订单么?",function(){$$.ajax({type:"post",url:siteAPIPath+"order/cancle_am_order.json",data:f,cache:!0,success:function(a,b,c){var d=JSON.parse(a);return 0==d.status&&(myApp.alert("订单取消成功！"),mainView.router.loadPage("order/order-hour-now-list.html"),setTimeout(function(){myApp.hidePreloader()},1e3)),999==d.status?(myApp.showPreloader("订单不存在！"),!1):void 0}})})});var l=function(a,c,d){$$("#shendu-submit").removeAttr("disabled");var f=JSON.parse(a.response);if("999"==f.status)return void myApp.alert(f.msg);var g=f.data,h=g.id;if(0==e&&mainView.router.loadPage("order/order-pay-success.html?order_no="+b+"&order_type=1"),2==e){var i=$$("#user_coupon_id").val();void 0==i&&(i=0);var j=localUrl+"/"+appName+"/wx-pay-pre.jsp";j+="?orderId="+h,j+="&userCouponId="+i,j+="&orderType=1",j+="&payOrderType=0",location.href=j}};$$(".shendu-submit").click(function(){$$("#shendu-submit").attr("disabled",!0);var a=$$("#user_coupon_id").val();void 0==a&&(a=0);var d={};d.user_id=c,d.order_no=b,d.user_coupon_id=a,$$('img[name="order_pay_types"]').each(function(a,b){$$(this).attr("src").indexOf("green")>0&&(e=$$(this).prev().val())}),d.order_pay_type=e,$$.ajax({type:"post",url:siteAPIPath+"order/post_pay.json",data:d,statusCode:{200:l,400:ajaxError,500:ajaxError}})})}),myApp.template7Data["page:order-list-shendubaojie-tijiao"]=function(){var a,b=localStorage.user_id,c=localStorage.u_order_no_param;return $$.ajax({type:"GET",url:siteAPIPath+"order/get_exp_clean_order_detail.json?order_no="+c+"&user_id="+b,dataType:"json",cache:!0,async:!1,success:function(b){a=b.data}}),a},myApp.template7Data["page:huodong-detail"]=function(){var a,b=localStorage.getItem("user_id");if(null==b||void 0==b)return void mainView.router.loadPage("login.html");var c=localStorage.getItem("socials_id");(null==c||void 0==c)&&(c=0);var d={};return d.id=c,d.user_id=b,$$.ajax({type:"GET",url:siteAPIPath+"dict/get_socials_detail.json",data:d,dataType:"json",cache:!0,async:!1,success:function(b){a=b.data}}),a},myApp.onPageInit("huodong-detail",function(a){var b=localStorage.getItem("user_id");if(void 0!=b&&""!=b&&0!=b){var c=localStorage.getItem("socials_id");(null==c||void 0==c)&&(c=0);var d=function(a,b,c){myApp.hideIndicator();JSON.parse(a.response)},e={};e.user_id=b,e.socials_id=c,$$(".save_submit").on("click",function(){$$.ajax({type:"POST",url:siteAPIPath+"dict/post_socials_call.json",data:e,dataType:"json",cache:!0,async:!1,statusCode:{200:d,400:ajaxError,500:ajaxError}})})}}),myApp.template7Data["page:huodong-list"]=function(){var a,b=localStorage.getItem("user_id");return null==b||void 0==b?void mainView.router.loadPage("login.html"):($$.ajax({type:"GET",url:siteAPIPath+"dict/get_socilas.json",dataType:"json",cache:!0,async:!1,success:function(b){a=b}}),a)},myApp.onPageBeforeInit("mine-add-addrs",function(a){var b=localStorage.user_id;addrId=a.query.addr_id;var c=a.query.return_url;if($$("#mine-addr-save").removeAttr("disabled"),void 0!=b&&""!=b&&0!=b){(void 0==addrId||""==addrId)&&(addrId=0),(void 0==c||""==c)&&(c="user/mine-addr-list.html"),$$("#user_id").val(b),$$("#addr_id").val(addrId);var d=function(a,b,d){myApp.hideIndicator(),$$("#mine-addr-save").removeAttr("disabled");var e=JSON.parse(a.response);return"999"==e.status?void myApp.alert(e.msg):(getAm(),localStorage.am_mobile=e.data.amMobile,void mainView.router.loadPage(c))};$$("#mine-addr-save").on("click",function(){if($$("#mine-addr-save").attr("disabled",!0),0==addrFormValidation())return $$("#mine-addr-save").removeAttr("disabled"),!1;var a=myApp.formToJSON("#addr-form");$$.ajax({type:"POST",url:siteAPIPath+"user/post_user_addrs.json",dataType:"json",cache:!1,data:a,statusCode:{200:d,400:ajaxError,500:ajaxError}})})}}),myApp.template7Data["page:mine-addr-list"]=function(){var a,b=localStorage.user_id;return $$.ajax({type:"GET",url:siteAPIPath+"user/get_user_addrs.json?user_id="+b,dataType:"json",cache:!0,async:!1,success:function(b){a=b}}),a},myApp.onPageInit("mine-addr-list",function(a){localStorage.user_id;$$(".mine-add-addr-link").on("click",function(){mainView.router.loadPage("user/mine-add-addr.html?addr_id=0")}),$$(document).on("click","#selectAddrLink",function(a){a.stopImmediatePropagation();var b=$$(this).find("input[name=addr_id]").val(),c=$$(this).find(".item-title").html();c=c.replace("[默认] ","");for(var d="",e=1;5>e;e++){var f=mainView.history[mainView.history.length-e];if(void 0!=f&&(f.indexOf("order-form-zhongdiangong")>=0||f.indexOf("order-list-shendubaojie-yuyue")>=0)){d=f;break}}""!=d&&(d=replaceParamVal(d,"addr_id",b),d=replaceParamVal(d,"addr_name",c),d.indexOf("?")<=0&&d.indexOf("addr")<=0&&(d=d+"?addr_id="+b+"&addr_name="+c),d.indexOf("&")<=0&&d.indexOf("addr")<=0&&(d=d+"&addr_id="+b+"&addr_name="+c),mainView.router.loadPage(d))})}),myApp.template7Data["page:mine-charge-list"]=function(){var a,b=localStorage.getItem("user_id");return(null==b||void 0==b)&&(b=0),$$.ajax({type:"GET",url:siteAPIPath+"/dict/get_cards.json?user_id="+b,dataType:"json",cache:!0,async:!1,success:function(b){a=b}}),a},myApp.onPageInit("mine-charge-list",function(a){var b=localStorage.getItem("user_id");void 0!=b&&""!=b&&0!=b&&($$(".charge-way").on("click",function(){var a=$$(this).prev().val(),b=$$(this).next().val();1e4>b&&mainView.router.loadPage("user/charge/mine-charge-way.html?card_id="+a+"&card_pay="+b)}),$$(".feed_back_money").on("click",function(){mainView.router.loadPage("user/charge/mine-charge-fanquan.html")}))}),myApp.onPageBeforeInit("charge-pay-success-page",function(a){var b=localStorage.getItem("user_id"),c=function(a,b,c){myApp.hideIndicator();var d=JSON.parse(a.response);if("999"==d.status)return void myApp.alert(a.msg);var e=d.data;$$("#rest_money").text(e.rest_money)};$$.ajax({type:"GET",url:siteAPIPath+"user/get_userinfo.json?user_id="+b,dataType:"json",cache:!1,statusCode:{200:c,400:ajaxError,500:ajaxError}}),$$("#charge-pay-success-btn").click(function(){mainView.router.loadPage("user/mine.html")})}),myApp.onPageBeforeInit("mine-charge-way",function(a){var b=localStorage.getItem("user_id"),c=a.query.card_id,d=a.query.card_pay;if(void 0!=b&&""!=b&&0!=b){if($$("#mobile").text(localStorage.getItem("user_mobile")),$$("#card_pay_view").text(d),void 0==d||""==d||0==d){var e=function(a,b,c){myApp.hideIndicator();var d=JSON.parse(a.response);if("999"==d.status)return void myApp.alert(a.msg);var e=d.data;$$("#card_pay_view").text(e.card_value)};$$.ajax({type:"GET",url:siteAPIPath+"dict/get_card_detail.json?card_id="+c,dataType:"json",cache:!1,statusCode:{200:e,400:ajaxError,500:ajaxError}})}var f=function(a,b,c){var d=JSON.parse(a.response);if("999"==d.status)return void myApp.alert(d.msg);var e=d.data.id,f=localUrl+"/"+appName+"/wx-pay-pre.jsp";f+="?orderId="+e,f+="&userCouponId=0",f+="&orderType=4",f+="&payOrderType=1",location.href=f};$$(".chongzhi-submit").click(function(){var a={};a.user_id=b,a.card_type=c,a.pay_type=2,$$.ajax({type:"post",url:siteAPIPath+"user/card_buy.json",data:a,statusCode:{200:f,400:ajaxError,500:ajaxError}})})}}),myApp.onPageInit("mine-coupon-list-page",function(a){var b=localStorage.getItem("user_id");void 0!=b&&""!=b&&0!=b&&(localStorage.u_order_money_param=a.query.order_money,localStorage.u_order_type_param=a.query.order_type,$$(document).on("click","#selectCouponLink",function(a){a.stopImmediatePropagation();for(var b="",c=1;5>c;c++){var d=mainView.history[mainView.history.length-c];if(void 0!=d&&(d.indexOf("order-view-0")>=0||d.indexOf("order-view-1")>=0||d.indexOf("order-view-2")>=0||d.indexOf("order-form-zhongdiangong-pay")>=0)){b=d;break}}if(""!=b){var e=localStorage.u_order_type_param,f=localStorage.u_order_money_param,g=$$(this).find("input[name=service_type]").val(),h=$$(this).find("input[name=max_value]").val(),i=$$(this).find("#user_coupon_id").val(),j=$$(this).find("#introduction").html(),k=$$(this).find("#user_coupon_value").val();if(g.indexOf(e)<0)return myApp.alert("当前优惠劵不适用!"),!1;if(void 0!=f&&parseFloat(f)<parseFloat(h))return myApp.alert("消费满"+h+"可用!"),!1;b=replaceParamVal(b,"user_coupon_id",i),b=replaceParamVal(b,"user_coupon_name",j),b=replaceParamVal(b,"user_coupon_value",k),b+=b.indexOf("?")>0?"&user_coupon_id="+i:"?user_coupon_id="+i,b+="&user_coupon_name="+j,b+="&user_coupon_value="+k,mainView.router.loadPage(b)}}),$$("#user-coupon-exchange-button").on("click",function(){exchangeUserCoupon(b)}))}),myApp.template7Data["page:mine-coupon-list-page"]=function(){var a,b=localStorage.getItem("user_id");return $$.ajax({type:"GET",url:siteAPIPath+"user/get_coupon.json?user_id="+b,dataType:"json",cache:!0,async:!1,success:function(b){a=b}}),a};var onExchangeSuccess=function(a,b,c){myApp.hideIndicator();var d=JSON.parse(a.response);if("999"==d.status)return void myApp.alert(d.msg);d.data;mainView.router.loadPage("user/coupon/mine-coupon-list.html?user_id=1")};myApp.onPageInit("mine-feed-back-info",function(a){var b=localStorage.getItem("user_id");void 0!=b&&""!=b&&0!=b&&$$(".feed-back-info-submit").on("click",function(){var a=$$("#service_content").val();return""==a||void 0==a?void myApp.alert("请输入您的意见详情！"):a.length>100?void myApp.alert("只能输入100个字"):void saveUserFeedBack(b)})});var saveUserFeedBackSuccess=function(a,b,c){var d=JSON.parse(a.response);return"999"==d.status?void myApp.alert(d.msg):(myApp.alert("您的意见我们已经收到，感谢您的反馈!"),void mainView.router.loadPage("user/mine.html"))};myApp.onPageBeforeInit("mine",function(a){var b=localStorage.getItem("user_id");void 0!=b&&""!=b&&0!=b&&(getUserInfos(b),$$("#mine-addr-list").on("click",function(){mainView.router.loadPage("user/mine-addr-list.html?user_id=0")}),$$("#mine-coupon-lists").on("click",function(){mainView.router.loadPage("user/coupon/mine-coupon-list.html?user_id="+b)}),$$("#mine-charge-list").on("click",function(){mainView.router.loadPage("user/charge/mine-charge-list.html?user_id="+b)}),$$("#mine-feedback-info").on("click",function(){mainView.router.loadPage("user/mine-feedback-info.html?user_id="+b)}),$$("#mine-more").on("click",function(){mainView.router.loadPage("user/more.html")}),$$("#mine-info").on("click",function(){mainView.router.loadPage("user/user-wancheng.html")}),$$(".user-logout").on("click",function(){localStorage.removeItem("mobile"),localStorage.removeItem("user_id"),localStorage.removeItem("im_username"),localStorage.removeItem("im_password"),localStorage.removeItem("service_type_addons_list"),localStorage.removeItem("service_type_list"),localStorage.removeItem("am_id"),localStorage.removeItem("am_mobile"),mainView.router.loadPage("index.html")}))});var onUserInfoSuccess=function(a,b,c){var d=JSON.parse(a.response);if("999"==d.status)return void myApp.alert(d.msg);var e=d.data,f=e.head_img;""!=f&&void 0!=f&&$$("#head_img-span").attr("src",e.head_img),$$("#mobile").text(e.mobile),$$("#total_coupon").text(e.total_coupon+" 张"),$$("#user-id").text(e.id),$$("#mine-rest-money").text(e.rest_money+" 元"),$$("#score").text(e.score);var g=Number(0),h=e.rest_money;g=h/100,g>=100&&(g=100),$$("#am-time-span").text("约"+g.toFixed(1)+"小时"),require.config({paths:{echarts:"http://echarts.baidu.com/build/dist"}}),require(["echarts","echarts/chart/gauge"],function(a){var b=a.init(document.getElementById("main"));option={tooltip:{formatter:"{a} <br/>{b} : {c}%"},series:[{type:"gauge",center:["50%","50%"],radius:[0,"75%"],startAngle:140,endAngle:-140,min:0,max:100,precision:0,splitNumber:10,axisLine:{show:!0,lineStyle:{color:[[.2,"lightgreen"],[.4,"orange"],[.8,"skyblue"],[1,"#ff4500"]],width:30}},axisTick:{show:!0,splitNumber:5,length:8,lineStyle:{color:"#eee",width:1,type:"solid"}},axisLabel:{show:!0,rotate:-90,formatter:function(a){switch(a+""){case"0":return"100";case"20":return"80";case"40":return"60";case"60":return"40";case"80":return"20";case"100":return"0";default:return""}},textStyle:{color:"#333"}},splitLine:{show:!0,length:30,lineStyle:{color:"#eee",width:2,type:"solid"}},pointer:{length:"80%",width:8,color:"auto"},tooltip:{show:!1},title:{show:!0,offsetCenter:["-65%",-10],textStyle:{color:"#333",fontSize:15}},detail:{show:!1,backgroundColor:"rgba(0,0,0,0)",borderWidth:0,borderColor:"#ccc",width:100,height:40,offsetCenter:["-60%",10],formatter:"{value}%",textStyle:{color:"auto",fontSize:30}},data:[{value:30}]}]};var c=Number(0),d=e.rest_money;c=d/100,c>=100&&(c=100),option.series[0].data[0].value=100-c.toFixed(1),b.setOption(option,!0)})};myApp.onPageBeforeInit("mine-more",function(a){var b=localStorage.getItem("user_id");void 0!=b&&""!=b&&0!=b&&($$("#mine-faq").on("click",function(){mainView.router.loadPage("user/faq.html")}),$$("#mine-agreement").on("click",function(){mainView.router.loadPage("user/agreement.html")}),$$("#mine-aboutus").on("click",function(){mainView.router.loadPage("user/aboutus.html")}))}),myApp.onPageBeforeInit("user-am-detail-page",function(a){var b=localStorage.user_id,c={};c.user_id=b,$$.ajax({type:"get",url:siteAPIPath+"user/user_get_am.json",data:c,cache:!0,success:function(a,b,c){var d=JSON.parse(a),e=d.data;""!=e&&(localStorage.setItem("am_id",e.staff_id),localStorage.setItem("am_mobile",e.mobile)),""!=e.head_img?$$("#staffImg").attr("src",e.head_img):$$("#staffImg").attr("src","./img/i-f7.png"),$$("#staffName").text("姓名:  "+e.name),$$("#cardNo").text("身份证号:  "+e.card_id);var f=/[\u4E00-\u9FA5]/g,g=moment(e.birth),h=moment(g).fromNow();$$("#age").text("年龄:  "+h.replace(f,"")+"岁"),$$("#callStaff").attr("href","tel:"+e.mobile);var i=getAstroName(e.astro);$$("#astro").text(i),$$("#bloodType").text(e.blood_type);for(var j=0;j<e.tag_list.length;j++)$$("#tagName").append("<a href='#' >"+e.tag_list[j].tag_name+"</a>&nbsp&nbsp&nbsp");$$("#orderNum").text("助理"+e.name+"已经为您服务"+e.order_num+"次啦"),$$("#intro").text(e.intro)}})}),myApp.onPageBeforeInit("user-wancheng",function(a){var b=localStorage.getItem("user_id");void 0!=b&&""!=b&&0!=b&&(getMineInfos(b),$$("#user_mine_submit").on("click",function(){$$("#user_mine_submit").attr("disabled",!0);var a=myApp.formToJSON("#user_wancheng");$$.ajax({type:"POST",url:siteAPIPath+"user/post_user_info.json?user_id="+b,dataType:"json",cache:!1,data:a,statusCode:{200:saveUserSuccess,400:ajaxError,500:ajaxError}})}))});var onMineInfoSuccess=function(a,b,c){var d=JSON.parse(a.response);if("999"==d.status)return void myApp.alert(d.msg);var e=d.data;$$("#user_mobile_span").text(e.mobile);var f={name:e.name};myApp.formFromJSON("#user_wancheng",f)};